
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>OkHttp · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Dispatcher.html" />
    
    
    <link rel="prev" href="../RxJava/背压问题.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">前言</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Android部分</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../Android/零碎知识点.html">
            
                <a href="../../Android/零碎知识点.html">
            
                    
                    零碎知识点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../Android/Activity的生命周期.html">
            
                <a href="../../Android/Activity的生命周期.html">
            
                    
                    Activity的生命周期和启动模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../Android/Fragment的生命周期.html">
            
                <a href="../../Android/Fragment的生命周期.html">
            
                    
                    Fragment的生命周期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../Android/Service的生命周期.html">
            
                <a href="../../Android/Service的生命周期.html">
            
                    
                    Service的生命周期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../Android/Broadcast.html">
            
                <a href="../../Android/Broadcast.html">
            
                    
                    Broadcast
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../Android/Android的内存泄漏总结.html">
            
                <a href="../../Android/Android的内存泄漏总结.html">
            
                    
                    Android的内存泄漏总结
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="../../Android/如何解决WebView的内存泄漏.html">
            
                <a href="../../Android/如何解决WebView的内存泄漏.html">
            
                    
                    如何解决WebView的内存泄漏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="../../Android/Android的性能优化.html">
            
                <a href="../../Android/Android的性能优化.html">
            
                    
                    Android性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="../../Android/IPC进程间通信/IPC机制.html">
            
                <a href="../../Android/IPC进程间通信/IPC机制.html">
            
                    
                    IPC通信
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.9.1" data-path="../../Android/IPC进程间通信/概述.html">
            
                <a href="../../Android/IPC进程间通信/概述.html">
            
                    
                    概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.2" data-path="../../Android/IPC进程间通信/Binder.html">
            
                <a href="../../Android/IPC进程间通信/Binder.html">
            
                    
                    Binder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.3" data-path="../../Android/IPC进程间通信/序列化.html">
            
                <a href="../../Android/IPC进程间通信/序列化.html">
            
                    
                    序列化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.4" data-path="../../Android/IPC进程间通信/使用Bundle.html">
            
                <a href="../../Android/IPC进程间通信/使用Bundle.html">
            
                    
                    使用Bundle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.5" data-path="../../Android/IPC进程间通信/使用文件.html">
            
                <a href="../../Android/IPC进程间通信/使用文件.html">
            
                    
                    使用文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.6" data-path="../../Android/IPC进程间通信/使用Messenger.html">
            
                <a href="../../Android/IPC进程间通信/使用Messenger.html">
            
                    
                    使用Messenger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9.7" data-path="../../Android/IPC进程间通信/使用Aidl.html">
            
                <a href="../../Android/IPC进程间通信/使用Aidl.html">
            
                    
                    使用AIDL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="../../Android/ListView和RecycleView.html">
            
                <a href="../../Android/ListView和RecycleView.html">
            
                    
                    ListView和RecyclerView
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="../../Android/View的事件分发机制/事件分发机制.html">
            
                <a href="../../Android/View的事件分发机制/事件分发机制.html">
            
                    
                    View事件分发
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.11.1" data-path="../../Android/View的事件分发机制/View的滑动.html">
            
                <a href="../../Android/View的事件分发机制/View的滑动.html">
            
                    
                    View的滑动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11.2" data-path="../../Android/View的事件分发机制/View的弹性滑动.html">
            
                <a href="../../Android/View的事件分发机制/View的弹性滑动.html">
            
                    
                    View的弹性滑动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11.3" data-path="../../Android/View的事件分发机制/View的事件分发.html">
            
                <a href="../../Android/View的事件分发机制/View的事件分发.html">
            
                    
                    View的事件分发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11.4" data-path="../../Android/View的事件分发机制/View的滑动冲突.html">
            
                <a href="../../Android/View的事件分发机制/View的滑动冲突.html">
            
                    
                    View的滑动冲突
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="../../Android/View的工作原理.html">
            
                <a href="../../Android/View的工作原理.html">
            
                    
                    View工作原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.13" data-path="../../Android/Android消息机制/Android消息机制.html">
            
                <a href="../../Android/Android消息机制/Android消息机制.html">
            
                    
                    Android的消息机制
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.13.1" data-path="../../Android/Android消息机制/ThreadLocal.html">
            
                <a href="../../Android/Android消息机制/ThreadLocal.html">
            
                    
                    ThreadLocal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.13.2" data-path="../../Android/Android消息机制/消息队列的工作原理.html">
            
                <a href="../../Android/Android消息机制/消息队列的工作原理.html">
            
                    
                    消息队列的工作原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.13.3" data-path="../../Android/Android消息机制/Looper的工作原理.html">
            
                <a href="../../Android/Android消息机制/Looper的工作原理.html">
            
                    
                    Looper的工作原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.13.4" data-path="../../Android/Android消息机制/Handler的工作原理.html">
            
                <a href="../../Android/Android消息机制/Handler的工作原理.html">
            
                    
                    Handler的工作原理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="../../Android/RemoteView.html">
            
                <a href="../../Android/RemoteView.html">
            
                    
                    RemoteView
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.15" data-path="../../Android/Android中的线程模型/IntentService.html">
            
                <a href="../../Android/Android中的线程模型/IntentService.html">
            
                    
                    线程模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.15.1" data-path="../../Android/Android中的线程模型/AsyncTask详解.html">
            
                <a href="../../Android/Android中的线程模型/AsyncTask详解.html">
            
                    
                    AsyncTask详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.15.2" data-path="../../Android/Android中的线程模型/线程池.html">
            
                <a href="../../Android/Android中的线程模型/线程池.html">
            
                    
                    线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.15.3" data-path="../../Android/Android中的线程模型/HandlerThread.html">
            
                <a href="../../Android/Android中的线程模型/HandlerThread.html">
            
                    
                    HandlerThread
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.16" data-path="../../Android/APK的安全性/如何攻击.html">
            
                <a href="../../Android/APK的安全性/如何攻击.html">
            
                    
                    APK的安全性
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.16.1" data-path="../../Android/APK的安全性/如何防御.html">
            
                <a href="../../Android/APK的安全性/如何防御.html">
            
                    
                    如何防御
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">开源框架</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../响应式编程.html">
            
                <a href="../响应式编程.html">
            
                    
                    响应式编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../图片加载库原理.html">
            
                <a href="../图片加载库原理.html">
            
                    
                    图片加载库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../热修复.html">
            
                <a href="../热修复.html">
            
                    
                    热修复
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../RxJava/RxJava.html">
            
                <a href="../RxJava/RxJava.html">
            
                    
                    RxJava
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="../RxJava/背压问题.html">
            
                <a href="../RxJava/背压问题.html">
            
                    
                    RxJava的背压问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="3.5" data-path="OkHttp的实现原理.html">
            
                <a href="OkHttp的实现原理.html">
            
                    
                    OkHttp
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.5.1" data-path="Dispatcher.html">
            
                <a href="Dispatcher.html">
            
                    
                    Dispatcher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5.2" data-path="ConnectionPool.html">
            
                <a href="ConnectionPool.html">
            
                    
                    ConnectionPool
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../插件化.html">
            
                <a href="../插件化.html">
            
                    
                    插件化技术
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Java部分</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../Java/final、finally、finalize的区别.html">
            
                <a href="../../Java/final、finally、finalize的区别.html">
            
                    
                    Java基础知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../Java/垃圾回收机制/垃圾回收机制.html">
            
                <a href="../../Java/垃圾回收机制/垃圾回收机制.html">
            
                    
                    垃圾回收机制
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../../Java/垃圾回收机制/对象已死吗.html">
            
                <a href="../../Java/垃圾回收机制/对象已死吗.html">
            
                    
                    对象已死吗？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../../Java/垃圾回收机制/HotSpot的算法实现.html">
            
                <a href="../../Java/垃圾回收机制/HotSpot的算法实现.html">
            
                    
                    HotSpot的算法实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../../Java/垃圾回收机制/内存分配与回收策略.html">
            
                <a href="../../Java/垃圾回收机制/内存分配与回收策略.html">
            
                    
                    内存分配与回收策略
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../../Java/抽象类和接口.html">
            
                <a href="../../Java/抽象类和接口.html">
            
                    
                    抽象类和接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../../Java/Servlet.html">
            
                <a href="../../Java/Servlet.html">
            
                    
                    Servlet（Server与Applet)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../../Java/Xml的解析.html">
            
                <a href="../../Java/Xml的解析.html">
            
                    
                    XML解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../../Java/集合/集合.html">
            
                <a href="../../Java/集合/集合.html">
            
                    
                    集合
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="../../Java/集合/HashMap的详解.html">
            
                <a href="../../Java/集合/HashMap的详解.html">
            
                    
                    HashMap详解
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="../../Java/类加载机制.html">
            
                <a href="../../Java/类加载机制.html">
            
                    
                    类加载机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="../../Java/线程池.html">
            
                <a href="../../Java/线程池.html">
            
                    
                    线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="../../Java/线程部分.html">
            
                <a href="../../Java/线程部分.html">
            
                    
                    线程部分
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="../../Java/Java中的内存模型与线程.html">
            
                <a href="../../Java/Java中的内存模型与线程.html">
            
                    
                    内存模型
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">操作系统</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../操作系统/线程调度.html">
            
                <a href="../../操作系统/线程调度.html">
            
                    
                    线程与进程
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">设计模式</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../设计模式/MVC与MVP.html">
            
                <a href="../../设计模式/MVC与MVP.html">
            
                    
                    MVC与MVP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../../设计模式/面向对象六大原则.html">
            
                <a href="../../设计模式/面向对象六大原则.html">
            
                    
                    面向对象六大原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../../设计模式/单例模式.html">
            
                <a href="../../设计模式/单例模式.html">
            
                    
                    单例模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../../设计模式/Builder模式.html">
            
                <a href="../../设计模式/Builder模式.html">
            
                    
                    Builder模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../../设计模式/代理模式.html">
            
                <a href="../../设计模式/代理模式.html">
            
                    
                    代理模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="../../设计模式/原型模式.html">
            
                <a href="../../设计模式/原型模式.html">
            
                    
                    原型模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="../../设计模式/外观模式.html">
            
                <a href="../../设计模式/外观模式.html">
            
                    
                    外观模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="../../设计模式/策略模式.html">
            
                <a href="../../设计模式/策略模式.html">
            
                    
                    策略模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.9" data-path="../../设计模式/简单工厂模式.html">
            
                <a href="../../设计模式/简单工厂模式.html">
            
                    
                    简单工厂
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.10" data-path="../../设计模式/观察者模式.html">
            
                <a href="../../设计模式/观察者模式.html">
            
                    
                    观察者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.11" data-path="../../设计模式/职责链模式.html">
            
                <a href="../../设计模式/职责链模式.html">
            
                    
                    职责链模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.12" data-path="../../设计模式/适配器模式.html">
            
                <a href="../../设计模式/适配器模式.html">
            
                    
                    适配器模式
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">计算机网络</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../计算机网络/基本知识.html">
            
                <a href="../../计算机网络/基本知识.html">
            
                    
                    网络基础知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../../计算机网络/TCP-IP协议分层.html">
            
                <a href="../../计算机网络/TCP-IP协议分层.html">
            
                    
                    网络协议分层
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../../计算机网络/TCP的三次握手四次挥手.html">
            
                <a href="../../计算机网络/TCP的三次握手四次挥手.html">
            
                    
                    三次握手四次挥手
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="../../计算机网络/Http/Http1.0.html">
            
                <a href="../../计算机网络/Http/Http1.0.html">
            
                    
                    HTTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="../../计算机网络/Http/Https.html">
            
                <a href="../../计算机网络/Http/Https.html">
            
                    
                    HTTPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="../../计算机网络/TCP.html">
            
                <a href="../../计算机网络/TCP.html">
            
                    
                    TCP
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">算法</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../../算法/排序算法/排序算法总结.html">
            
                <a href="../../算法/排序算法/排序算法总结.html">
            
                    
                    排序算法
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1.1" data-path="../../算法/排序算法/插入排序.html">
            
                <a href="../../算法/排序算法/插入排序.html">
            
                    
                    插入排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.2" data-path="../../算法/排序算法/冒泡排序.html">
            
                <a href="../../算法/排序算法/冒泡排序.html">
            
                    
                    冒泡排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.3" data-path="../../算法/排序算法/快速排序.html">
            
                <a href="../../算法/排序算法/快速排序.html">
            
                    
                    快速排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.4" data-path="../../算法/排序算法/选择排序.html">
            
                <a href="../../算法/排序算法/选择排序.html">
            
                    
                    选择排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.5" data-path="../../算法/排序算法/堆排序.html">
            
                <a href="../../算法/排序算法/堆排序.html">
            
                    
                    堆排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.6" data-path="../../算法/排序算法/归并排序.html">
            
                <a href="../../算法/排序算法/归并排序.html">
            
                    
                    归并排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.7" data-path="../../算法/排序算法/计数排序.html">
            
                <a href="../../算法/排序算法/计数排序.html">
            
                    
                    计数排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.8" data-path="../../算法/排序算法/基数排序.html">
            
                <a href="../../算法/排序算法/基数排序.html">
            
                    
                    基数排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.9" data-path="../../算法/排序算法/木桶排序.html">
            
                <a href="../../算法/排序算法/木桶排序.html">
            
                    
                    木桶排序
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../../算法/字符串压缩算法.html">
            
                <a href="../../算法/字符串压缩算法.html">
            
                    
                    字符串压缩
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../../算法/LeetCode 日常刷题（1）.html">
            
                <a href="../../算法/LeetCode 日常刷题（1）.html">
            
                    
                    LeetCode日常刷题1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="../../算法/LeetCode日常刷题（2）.html">
            
                <a href="../../算法/LeetCode日常刷题（2）.html">
            
                    
                    LeetCode日常刷题2
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">数据结构</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../../数据结构/各种树.html">
            
                <a href="../../数据结构/各种树.html">
            
                    
                    数据结构各种树
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">面经</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="../../面经/牛客秋招android面经9月%28至9.16号%29合集.md">
            
                <span>
            
                    
                    牛客网面经
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >OkHttp</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="okhttp">OKHttp</h1>
<p>Android&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;HTTP&#x4EA4;&#x4E92;&#x7684;&#x65B9;&#x5F0F;&#xFF1A;HttpURLConnection &#x548C; Apache HTTP Client&#xFF0C;&#x867D;&#x7136;&#x4E24;&#x8005;&#x90FD;&#x652F;&#x6301;HTTPS&#xFF0C;&#x6D41;&#x7684;&#x4E0A;&#x4F20;&#x548C;&#x4E0B;&#x8F7D;&#xFF0C;&#x914D;&#x7F6E;&#x8D85;&#x65F6;&#xFF0C;IPv6&#x548C;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x5DF2;&#x8DB3;&#x591F;&#x6EE1;&#x8DB3;&#x6211;&#x4EEC;&#x5404;&#x79CD;HTTP&#x8BF7;&#x6C42;&#x7684;&#x9700;&#x6C42;&#x3002;&#x4F46;&#x66F4;&#x9AD8;&#x6548;&#x7684;&#x4F7F;&#x7528;HTTP&#x53EF;&#x4EE5;&#x8BA9;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x8FD0;&#x884C;&#x66F4;&#x5FEB;&#x3001;&#x66F4;&#x8282;&#x7701;&#x6D41;&#x91CF;&#x3002;&#x800C;OkHttp&#x5E93;&#x5C31;&#x662F;&#x4E3A;&#x6B64;&#x800C;&#x751F;&#x3002;</p>
<p>OkHttp&#x662F;&#x4E00;&#x4E2A;&#x9AD8;&#x6548;&#x7684;HTTP&#x5E93;:</p>
<blockquote>
<ul>
<li>&#x652F;&#x6301; SPDY &#xFF0C;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;Socket&#x6765;&#x5904;&#x7406;&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6240;&#x6709;&#x8BF7;&#x6C42;</li>
<li>&#x5982;&#x679C;SPDY&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x5219;&#x901A;&#x8FC7;&#x8FDE;&#x63A5;&#x6C60;&#x6765;&#x51CF;&#x5C11;&#x8BF7;&#x6C42;&#x5EF6;&#x65F6;</li>
<li>&#x65E0;&#x7F1D;&#x7684;&#x652F;&#x6301;GZIP&#x6765;&#x51CF;&#x5C11;&#x6570;&#x636E;&#x6D41;&#x91CF;</li>
<li>&#x7F13;&#x5B58;&#x54CD;&#x5E94;&#x6570;&#x636E;&#x6765;&#x51CF;&#x5C11;&#x91CD;&#x590D;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</li>
</ul>
</blockquote>
<p>&#x4F1A;&#x4ECE;&#x5F88;&#x591A;&#x5E38;&#x7528;&#x7684;&#x8FDE;&#x63A5;&#x95EE;&#x9898;&#x4E2D;&#x81EA;&#x52A8;&#x6062;&#x590D;&#x3002;&#x5982;&#x679C;&#x60A8;&#x7684;&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x4E86;&#x591A;&#x4E2A;IP&#x5730;&#x5740;&#xFF0C;&#x5F53;&#x7B2C;&#x4E00;&#x4E2A;IP&#x8FDE;&#x63A5;&#x5931;&#x8D25;&#x7684;&#x65F6;&#x5019;&#xFF0C;OkHttp&#x4F1A;&#x81EA;&#x52A8;&#x5C1D;&#x8BD5;&#x4E0B;&#x4E00;&#x4E2A;IP&#x3002;OkHttp&#x8FD8;&#x5904;&#x7406;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x95EE;&#x9898;&#x548C;SSL&#x63E1;&#x624B;&#x5931;&#x8D25;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x4F7F;&#x7528; OkHttp &#x65E0;&#x9700;&#x91CD;&#x5199;&#x60A8;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x7F51;&#x7EDC;&#x4EE3;&#x7801;&#x3002;OkHttp&#x5B9E;&#x73B0;&#x4E86;&#x51E0;&#x4E4E;&#x548C;java.net.HttpURLConnection&#x4E00;&#x6837;&#x7684;API&#x3002;&#x5982;&#x679C;&#x60A8;&#x7528;&#x4E86; Apache HttpClient&#xFF0C;&#x5219;OkHttp&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;okhttp-apache &#x6A21;&#x5757;&#x3002;</p>
<p>OKHttp&#x6E90;&#x7801;&#x4F4D;&#x7F6E;<a href="https://github.com/square/okhttp" target="_blank">https://github.com/square/okhttp</a></p>
<h1 id="&#x4F7F;&#x7528;">&#x4F7F;&#x7528;</h1>
<p>&#x7B80;&#x5355;&#x4F7F;&#x7528;&#x4EE3;&#x7801;</p>
<pre><code>private final OkHttpClient client = new OkHttpClient();

public void run() throws Exception {
    Request request = new Request.Builder()
        .url(&quot;https://api.github.com/repos/square/okhttp/issues&quot;)
        .header(&quot;User-Agent&quot;, &quot;OkHttp Headers.java&quot;)
        .addHeader(&quot;Accept&quot;, &quot;application/json; q=0.5&quot;)
        .addHeader(&quot;Accept&quot;, &quot;application/vnd.github.v3+json&quot;)
        .build();

    Response response = client.newCall(request).execute();
    if (!response.isSuccessful()) throw new IOException(&quot;Unexpected code &quot; + response);

    System.out.println(&quot;Server: &quot; + response.header(&quot;Server&quot;));
    System.out.println(&quot;Date: &quot; + response.header(&quot;Date&quot;));
    System.out.println(&quot;Vary: &quot; + response.headers(&quot;Vary&quot;));
}
</code></pre><p>&#x5728;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E0D;&#x505A;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#xFF0C;<a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0106/2275.html" target="_blank">&#x63A8;&#x8350;&#x4E00;&#x7BC7;&#x5173;&#x4E8E;OKHttp&#x7684;&#x8BE6;&#x7EC6;&#x4F7F;&#x7528;&#x6559;&#x7A0B;</a>&#xFF0C;&#x4E0B;&#x9762;&#x8F6C;&#x5165;&#x6E90;&#x7801;&#x7684;&#x5206;&#x6790;&#x3002;</p>
<h1 id="&#x603B;&#x4F53;&#x8BBE;&#x8BA1;-">&#x603B;&#x4F53;&#x8BBE;&#x8BA1; <a href="http://frodoking.github.io/img/android/okhttp_instructure.png" target="_blank"><img src="http://frodoking.github.io/img/android/okhttp_instructure.png" alt="OKHttp&#x603B;&#x4F53;&#x8BBE;&#x8BA1;&#x56FE;"></a></h1>
<p>&#x4E0A;&#x9762;&#x662F;OKHttp&#x603B;&#x4F53;&#x8BBE;&#x8BA1;&#x56FE;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;<strong>Diapatcher&#x4E0D;&#x65AD;&#x4ECE;RequestQueue&#x4E2D;&#x53D6;&#x51FA;&#x8BF7;&#x6C42;&#xFF08;Call&#xFF09;</strong>&#xFF0C;&#x6839;&#x636E;&#x662F;&#x5426;&#x5DF2;&#x7F13;&#x5B58;&#x8C03;&#x7528;Cache&#x6216;Network&#x8FD9;&#x4E24;&#x7C7B;&#x6570;&#x636E;&#x83B7;&#x53D6;&#x63A5;&#x53E3;&#x4E4B;&#x4E00;&#xFF0C;&#x4ECE;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x6216;&#x662F;&#x670D;&#x52A1;&#x5668;&#x53D6;&#x5F97;&#x8BF7;&#x6C42;&#x7684;&#x6570;&#x636E;&#x3002;&#x8BE5;&#x5F15;&#x64CE;&#x6709;&#x540C;&#x6B65;&#x548C;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#xFF0C;&#x540C;&#x6B65;&#x8BF7;&#x6C42;&#x901A;&#x8FC7;Call.execute()&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7684;Response&#xFF0C;&#x800C;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x4F1A;&#x628A;&#x5F53;&#x524D;&#x7684;&#x8BF7;&#x6C42;Call.enqueue&#x6DFB;&#x52A0;&#xFF08;AsyncCall&#xFF09;&#x5230;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x56DE;&#x8C03;&#xFF08;Callback&#xFF09;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x83B7;&#x53D6;&#x6700;&#x540E;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x4F1A;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x7C7B;&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x4E9B;&#x57FA;&#x7840;IO&#x65B9;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x4E3B;&#x8981;&#x6765;&#x4E4B;iohttp&#x8FD9;&#x4E2A;&#x5305;&#x3002;&#x8FD9;&#x4E9B;&#x7C7B;&#x7684;&#x89E3;&#x91CA;&#x5927;&#x90E8;&#x5206;&#x6765;&#x81F3;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x672C;&#x8EAB;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6B64;&#x4E0D;&#x4F1A;&#x7FFB;&#x8BD1;&#x6210;&#x4E2D;&#x6587;&#xFF0C;&#x672C;&#x4EBA;&#x89C9;&#x5F97;&#x82F1;&#x8BED;&#x539F;&#x6587;&#x66F4;&#x80FD;&#x51C6;&#x786E;&#x8868;&#x8FBE;&#x5B83;&#x81EA;&#x8EAB;&#x7684;&#x4F5C;&#x7528;&#x3002;</p>
<h1 id="okhttp&#x4E2D;&#x91CD;&#x8981;&#x7684;&#x7C7B;">OKHttp&#x4E2D;&#x91CD;&#x8981;&#x7684;&#x7C7B;</h1>
<p><strong>1.Route.java</strong><br>The concrete route used by a connection to reach an abstract origin server.<br>When creating a connection the client has many options:</p>
<p>&#x8BD1;&#xFF1A;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5230;&#x8FBE;&#x62BD;&#x8C61;&#x6E90;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FDE;&#x63A5;&#x7684;&#x5177;&#x4F53;&#x8DEF;&#x7531;&#x65B9;&#x5F0F;&#xFF0C;&#x5F53;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x5F88;&#x591A;&#x9009;&#x62E9;&#xFF1A;</p>
<blockquote>
<ul>
<li>HTTP proxy: a proxy server may be explicitly configured for the client. Otherwise the {@linkplain java.net.ProxySelector proxy selector} is used. It may return multiple proxies to attempt.</li>
<li>IP address: whether connecting directly to an origin server or a proxy, opening a socket requires an IP address. The DNS server may return multiple IP addresses to attempt.</li>
<li>TLS configuration: which cipher suites and TLS versions to attempt with the HTTPS connection.</li>
<li>HTTP&#x4EE3;&#x7406;&#xFF1A;&#x53EF;&#x4EE5;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x663E;&#x793A;&#x7684;&#x914D;&#x7F6E;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x4F1A;&#x4F7F;&#x7528;{@linkplain java.net.ProxySelector proxy selector}&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x8FD4;&#x56DE;&#x591A;&#x4E2A;&#x4EE3;&#x7406;&#x9009;&#x9879;&#x8FDB;&#x884C;&#x5C1D;&#x8BD5;&#x3002;</li>
<li>IP&#x5730;&#x5740;&#xFF1A;&#x65E0;&#x8BBA;&#x662F;&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x5230;&#x539F;&#x59CB;&#x670D;&#x52A1;&#x5668;&#x8FD8;&#x662F;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6253;&#x5F00;&#x5957;&#x63A5;&#x5B57;&#x90FD;&#x9700;&#x8981;&#x4E00;&#x4E2A;IP&#x5730;&#x5740;&#x3002; DNS&#x670D;&#x52A1;&#x5668;&#x53EF;&#x80FD;&#x4F1A;&#x8FD4;&#x56DE;&#x591A;&#x4E2A;IP&#x5730;&#x5740;&#x5C1D;&#x8BD5;&#x3002;</li>
<li>TLS&#x914D;&#x7F6E;&#xFF1A;&#x5BC6;&#x7801;&#x5957;&#x4EF6;&#x548C;TLS&#x7248;&#x672C;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;HTTPS&#x8FDE;&#x63A5;&#x3002;</li>
</ul>
</blockquote>
<p>Each route is a specific selection of these options.<br>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5BF9;&#x5730;&#x5740;&#x7684;&#x4E00;&#x4E2A;&#x5C01;&#x88C5;&#x7C7B;&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x3002;</p>
<p><strong>2.Platform.java</strong><br>Access to platform-specific features.</p>
<blockquote>
<ul>
<li>Server name indication (SNI): Supported on Android 2.3+.</li>
<li>Session Tickets: Supported on Android 2.3+.</li>
<li>Android Traffic Stats (Socket Tagging): Supported on Android 4.0+.</li>
<li>ALPN (Application Layer Protocol Negotiation): Supported on Android 5.0+. The APIs were present in Android 4.4, but that implementation was unstable.</li>
</ul>
</blockquote>
<p>Supported on OpenJDK 7 and 8 (via the JettyALPN-boot library).<br>&#x8FD9;&#x4E2A;&#x7C7B;&#x4E3B;&#x8981;&#x662F;&#x505A;&#x5E73;&#x53F0;&#x9002;&#x5E94;&#x6027;&#xFF0C;&#x9488;&#x5BF9;Android2.3&#x5230;5.0&#x540E;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x9002;&#x914D;&#x652F;&#x6301;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x7C7B;&#x4E2D;&#x80FD;&#x770B;&#x5230;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#xFF0C;&#x901A;&#x8FC7;java&#x53CD;&#x5C04;&#x4E0D;&#x540C;&#x7684;class&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<p><strong>3.Connnection.java</strong><br>The sockets and streams of an HTTP, HTTPS, or HTTPS+SPDY connection. May be used for multiple HTTP request/response exchanges. Connections may be direct to the origin server or via a proxy.  </p>
<p>&#x8BD1;&#xFF1A;HTTP&#xFF0C;HTTPS&#x6216;HTTPS + SPDY&#x8FDE;&#x63A5;&#x7684;&#x5957;&#x63A5;&#x5B57;&#x548C;&#x6D41;&#x3002; &#x53EF;&#x7528;&#x4E8E;&#x591A;&#x4E2A;HTTP&#x8BF7;&#x6C42;/&#x54CD;&#x5E94;&#x4EA4;&#x6362;&#x3002; &#x8FDE;&#x63A5;&#x53EF;&#x80FD;&#x76F4;&#x63A5;&#x5230;&#x6E90;&#x670D;&#x52A1;&#x5668;&#x6216;&#x901A;&#x8FC7;&#x4EE3;&#x7406;&#x3002;</p>
<p>Typically instances of this class are created, connected and exercised automatically by the HTTP client. Applications may use this class to monitor HTTP connections as members of a ConnectionPool.  </p>
<p>&#x8BD1;&#xFF1A;&#x901A;&#x5E38;&#x8BE5;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x7531;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#xFF0C;&#x8FDE;&#x63A5;&#x548C;&#x8FD0;&#x884C;&#x3002; &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;&#x7C7B;&#x6765;&#x76D1;&#x89C6;&#x4F5C;&#x4E3A;ConnectionPool&#x6210;&#x5458;&#x7684;HTTP&#x8FDE;&#x63A5;&#x3002;</p>
<p>Do not confuse this class with the misnamed HttpURLConnection, which isn&#x2019;t so much a connection as a single request/response exchange.  </p>
<p>&#x8BD1;&#xFF1A;&#x4E0D;&#x8981;&#x5C06;&#x8FD9;&#x4E2A;&#x7C7B;&#x4E0E;HttpURLConnection&#x6DF7;&#x6DC6;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x7684;&#x8BF7;&#x6C42;/&#x54CD;&#x5E94;&#x4EA4;&#x6362;&#x7684;&#x8FDE;&#x63A5;&#x3002;</p>
<p>Modern TLS<br>There are tradeoffs when selecting which options to include when negotiating a secure connection to a remote host. Newer TLS options are quite useful:</p>
<p>&#x8BD1;&#xFF1A;&#x73B0;&#x4EE3;TLS&#xFF0C;&#x5F53;&#x9009;&#x62E9;&#x5728;&#x534F;&#x5546;&#x4E0E;&#x8FDC;&#x7A0B;&#x4E3B;&#x673A;&#x7684;&#x5B89;&#x5168;&#x8FDE;&#x63A5;&#x65F6;&#x8981;&#x5305;&#x62EC;&#x54EA;&#x4E9B;&#x9009;&#x9879;&#x65F6;&#xFF0C;&#x6709;&#x6743;&#x8861;&#x3002; &#x8F83;&#x65B0;&#x7684;TLS&#x9009;&#x9879;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF1A;</p>
<blockquote>
<ul>
<li>Server Name Indication (SNI) enables one IP address to negotiate secure connections for multiple domain names.</li>
<li>SNI&#x6709;&#x6548;&#xFF1A;&#x4E00;&#x4E2A;IP&#x5730;&#x5740;&#x7528;&#x6765;&#x534F;&#x8C03;&#x591A;&#x4E2A;&#x57DF;&#x540D;&#x7684;&#x5B89;&#x5168;&#x8FDE;&#x63A5;</li>
<li>Application Layer Protocol Negotiation (ALPN) enables the HTTPS port (443) to be used for different HTTP and SPDY protocols.</li>
<li>ALPN&#x6709;&#x6548;&#xFF1A;443HTTPS&#x7AEF;&#x53E3;&#x53EF;&#x7528;&#x4E8E;&#x4E0D;&#x540C;&#x7684;HTTP&#x548C;SPDY&#x534F;&#x8BAE;</li>
</ul>
</blockquote>
<p>Unfortunately, older HTTPS servers refuse to connect when such options are presented. Rather than avoiding these options entirely, this class allows a connection to be attempted with modern options and then retried without them should the attempt fail.</p>
<p>&#x8BD1;&#xFF1A;&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x5F53;&#x63D0;&#x4F9B;&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x65F6;&#xFF0C;&#x8F83;&#x65E7;&#x7684;HTTPS&#x670D;&#x52A1;&#x5668;&#x62D2;&#x7EDD;&#x8FDE;&#x63A5;&#x3002; &#x4E3A;&#x4E86;&#x4E0D;&#x5B8C;&#x5168;&#x907F;&#x514D;&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x4E2A;&#x7C7B;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x73B0;&#x4EE3;&#x9009;&#x9879;&#x5C1D;&#x8BD5;&#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x4E14;&#x5177;&#x6709;&#x5931;&#x8D25;&#x91CD;&#x8BD5;&#x673A;&#x5236;&#x3002;</p>
<p><strong>4.ConnnectionPool.java</strong><br>Manages reuse of HTTP and SPDY connections for reduced network latency. HTTP requests that share the same Address may share a Connection. This class implements the policy of which connections to keep open for future use.<br>The system-wide default uses system properties for tuning parameters:</p>
<p>&#x8BD1;&#xFF1A;&#x7BA1;&#x7406;HTTP&#x548C;SPDY&#x8FDE;&#x63A5;&#x7684;&#x91CD;&#x7528;&#xFF0C;&#x4EE5;&#x51CF;&#x5C11;&#x7F51;&#x7EDC;&#x5EF6;&#x8FDF;&#x3002; &#x5171;&#x4EAB;&#x76F8;&#x540C;&#x5730;&#x5740;&#x7684;HTTP&#x8BF7;&#x6C42;&#x53EF;&#x80FD;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x3002; &#x8BE5;&#x7C7B;&#x5B9E;&#x73B0;&#x4E86;&#x4FDD;&#x6301;&#x5F00;&#x653E;&#x4EE5;&#x4F9B;&#x5C06;&#x6765;&#x4F7F;&#x7528;&#x7684;&#x8FDE;&#x63A5;&#x7684;&#x7B56;&#x7565;&#x3002;&#x7CFB;&#x7EDF;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x5C5E;&#x6027;&#x8C03;&#x6574;&#x53C2;&#x6570;&#xFF1A;</p>
<blockquote>
<ul>
<li>http.keepAlive true if HTTP and SPDY connections should be pooled at all. Default is true.</li>
<li>&#x5982;&#x679C;Http&#x548C;SPDY&#x8FDE;&#x63A5;&#x5E94;&#x8BE5;&#x8FDE;&#x63A5;&#xFF08;&#x6C47;&#x96C6;&#xFF09;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x5219;http.keepAlive&#x5C5E;&#x6027;&#x5E94;&#x4E3A;true&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;true</li>
<li>http.maxConnections maximum number of idle connections to each to keep in the pool. Default is 5.</li>
<li>http.maxConnections &#x662F;&#x8FDE;&#x63A5;&#x6C60;&#x4E2D;&#x4FDD;&#x7559;&#x7684;&#x6700;&#x5927;&#x7A7A;&#x95F2;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;5</li>
<li>http.keepAliveDuration Time in milliseconds to keep the connection alive in the pool before closing it. Default is 5 minutes. This property isn&#x2019;t used by HttpURLConnection.</li>
<li>http.keepAliveDuration&#x5728;&#x5173;&#x95ED;&#x5B83;&#x4E4B;&#x524D;&#x4FDD;&#x6301;&#x8FDE;&#x63A5;&#x5728;&#x6C60;&#x4E2D;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;5&#x5206;&#x949F;&#x3002; HttpURLConnection&#x4E0D;&#x4F7F;&#x7528;&#x6B64;&#x5C5E;&#x6027;&#x3002;</li>
</ul>
</blockquote>
<p>The default instance doesn&#x2019;t adjust its configuration as system properties are changed. This assumes that the applications that set these parameters do so before making HTTP connections, and that this class is initialized lazily.</p>
<p>&#x9ED8;&#x8BA4;&#x5B9E;&#x4F8B;&#x4E0D;&#x4F1A;&#x8C03;&#x6574;&#x968F;&#x7740;&#x7CFB;&#x7EDF;&#x5C5E;&#x6027;&#x7684;&#x66F4;&#x6539;&#x800C;&#x66F4;&#x6539;&#x3002; &#x8FD9;&#x5047;&#x8BBE;&#x5728;&#x8FDB;&#x884C;HTTP&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x7C7B;&#x88AB;&#x61D2;&#x60F0;&#x5730;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<p><strong>5.Request.java</strong><br>An HTTP request. Instances of this class are immutable if their body is null or itself immutable.(Builder&#x6A21;&#x5F0F;)</p>
<p>&#x8BD1;&#xFF1A;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x7684;&#x4E3B;&#x4F53;&#x662F;&#x7A7A;&#x7684;&#x6216;&#x8005;&#x5B83;&#x672C;&#x8EAB;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF08;Builder&#x6A21;&#x5F0F;&#xFF09;</p>
<p><strong>6.Response.java</strong><br>An HTTP response. Instances of this class are not immutable: the response body is a one-shot value that may be consumed <strong>only once</strong>. All other properties are immutable.</p>
<p>&#x8BD1;&#xFF1A;HTTP&#x54CD;&#x5E94;&#x3002; &#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x4E0D;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF1A;&#x54CD;&#x5E94;&#x4F53;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x53EA;&#x7528;&#x4E00;&#x6B21;**&#x7684;&#x4E00;&#x6B21;&#x6027;&#x503C;&#x3002; &#x6240;&#x6709;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#x90FD;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x3002;</p>
<p><strong>7.Call.java</strong><br>A call is a request that has been prepared for execution. A call can be canceled. As this object represents a single request/response pair (stream), <strong>it cannot be executed twice</strong>.</p>
<p>&#x8BD1;&#xFF1A;&#x4E00;&#x4E2A;Call&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x6267;&#x884C;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x88AB;&#x53D6;&#x6D88;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x8868;&#x793A;&#x5355;&#x72EC;&#x7684;&#x8BF7;&#x6C42;&#x6216;&#x8005;&#x54CD;&#x5E94;&#x5BF9;&#xFF0C;&#x4E0D;&#x80FD;&#x88AB;&#x6267;&#x884C;&#x4E24;&#x6B21;&#x4EE5;&#x4E0A;&#x3002;</p>
<p><strong>8.Dispatcher.java</strong><br>Policy on when async requests are executed.</p>
<p>Each dispatcher uses an <strong>ExecutorService</strong> to run calls internally. If you supply your own executor, it should be able to run configured maximum number of calls concurrently.</p>
<p>&#x8BD1;&#xFF1A;&#x6267;&#x884C;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x65F6;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x6BCF;&#x4E2A;&#x8C03;&#x5EA6;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;ExecutorService&#x6765;&#x5185;&#x90E8;&#x8FD0;&#x884C;Call&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x81EA;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;&#x6267;&#x884C;&#x5668;&#xFF0C;&#x5B83;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x540C;&#x65F6;&#x8FD0;&#x884C;&#x5DF2;&#x914D;&#x7F6E;&#x7684;&#x6700;&#x5927;&#x5E76;&#x53D1;Call&#x6570;&#x3002;</p>
<p><strong>9.HttpEngine.java</strong><br>Handles <strong>a single HTTP request/response pair</strong>. Each HTTP engine follows this<br>lifecycle:</p>
<p>&#x8BD1;&#xFF1A;&#x5904;&#x7406;&#x5355;&#x4E2A;Http&#x8BF7;&#x6C42;/&#x54CD;&#x5E94;&#x5BF9;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;Http&#x5F15;&#x64CE;&#x90FD;&#x9075;&#x5FAA;&#x8FD9;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF1A;</p>
<blockquote>
<ul>
<li>It is created.</li>
<li>&#x521B;&#x5EFA;</li>
<li>The HTTP request message is sent with sendRequest(). Once the request is sent it is an error to modify the request headers. After sendRequest() has been called the request body can be written to if it exists.</li>
<li>&#x4F7F;&#x7528;sendRequest&#x53D1;&#x9001;&#x4E00;&#x4E2A;Http&#x8BF7;&#x6C42;&#x4FE1;&#x606F;&#xFF0C;&#x4E00;&#x65E6;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x88AB;&#x53D1;&#x9001;&#xFF0C;&#x4FEE;&#x6539;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;header&#x5C06;&#x4F1A;&#x662F;&#x4E00;&#x4E2A;error&#xFF0C;&#x5728;sendRequest&#x88AB;&#x8C03;&#x7528;&#x4E4B;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x8BF7;&#x6C42;&#x4F53;&#x5B58;&#x5728;&#x5219;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x5199;&#x5165;&#x3002;</li>
<li>The HTTP response message is read with readResponse(). After the response has been read the response headers and body can be read. All responses have a response body input stream, though in some instances this stream is empty.</li>
<li>&#x4F7F;&#x7528;readResponse &#x8BFB;&#x53D6;HTTP&#x54CD;&#x5E94;&#x6D88;&#x606F;&#x3002; &#x54CD;&#x5E94;&#x5DF2;&#x88AB;&#x8BFB;&#x53D6;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x54CD;&#x5E94;&#x6807;&#x9898;&#x548C;&#x6B63;&#x6587;&#x3002; &#x6240;&#x6709;&#x54CD;&#x5E94;&#x90FD;&#x6709;&#x54CD;&#x5E94;&#x4F53;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x4F46;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6B64;&#x6D41;&#x4E3A;&#x7A7A;&#x3002;</li>
</ul>
</blockquote>
<p>The request and response may be served by the HTTP response <strong>cache</strong>, by the <strong>network</strong>, or by <strong>both</strong> in the event of a conditional GET.</p>
<p>&#x8BD1;&#xFF1A;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x53EF;&#x4EE5;&#x7531;http&#x54CD;&#x5E94;&#x7F13;&#x5B58;&#xFF0C;&#x6216;&#x8005;&#x7F51;&#x7EDC;&#xFF0C;&#x6216;&#x8005;&#x4E24;&#x8005;&#x90FD;&#x6709;&#xFF0C;&#x5728;Get&#x60C5;&#x51B5;&#x4E0B;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;</p>
<p><strong>10.Internal.java</strong><br>Escalate internal APIs in {@code com.squareup.okhttp} so they can be used from OkHttp&#x2019;s implementation packages. The only implementation of this interface is in {@link com.squareup.okhttp.OkHttpClient}.</p>
<p>&#x8BD1;&#xFF1A;&#x5728;{@code com.squareup.okhttp}&#x4E2D;&#x5347;&#x7EA7;&#x5185;&#x90E8;API&#xFF0C;&#x4EE5;&#x4FBF;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;OkHttp&#x7684;&#x5B9E;&#x73B0;&#x5305;&#x4E2D;&#x4F7F;&#x7528;&#x3002; &#x6B64;&#x63A5;&#x53E3;&#x7684;&#x552F;&#x4E00;&#x5B9E;&#x73B0;&#x662F;&#x5728;{@link com.squareup.okhttp.OkHttpClient}&#x4E2D;&#x3002;</p>
<p><strong>11.Cache.java</strong><br>Caches HTTP and HTTPS responses to the filesystem so they may be reused, saving time and bandwidth.</p>
<p>&#x7F13;&#x5B58;HTTP&#x548C;HTTPS&#x5BF9;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x54CD;&#x5E94;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x91CD;&#x7528;&#xFF0C;&#x4ECE;&#x800C;&#x8282;&#x7701;&#x65F6;&#x95F4;&#x548C;&#x5E26;&#x5BBD;&#x3002;</p>
<p><strong>Cache Optimization</strong><br>To measure cache effectiveness, this class tracks three statistics:</p>
<p>&#x8BD1;&#xFF1A;&#x4E3A;&#x4E86;&#x8861;&#x91CF;&#x7F13;&#x5B58;&#x7684;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x8BE5;&#x7C7B;&#x8DDF;&#x8E2A;&#x4E09;&#x4E2A;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#xFF1A;</p>
<blockquote>
<ul>
<li>Request Count: the number of HTTP requests issued since this cache was created.</li>
<li>&#x8BF7;&#x6C42;&#x8BA1;&#x6570;&#xFF1A;&#x521B;&#x5EFA;&#x6B64;&#x7F13;&#x5B58;&#x540E;&#x53D1;&#x51FA;&#x7684;Http&#x8BF7;&#x6C42;&#x6570;</li>
<li>Network Count: the number of those requests that required network use.</li>
<li>&#x7F51;&#x7EDC;&#x8BA1;&#x6570;&#xFF1A;&#x9700;&#x8981;&#x7F51;&#x7EDC;&#x4F7F;&#x7528;&#x7684;&#x8BF7;&#x6C42;&#x6570;</li>
<li>Hit Count: the number of those requests whose responses were served by the cache.</li>
<li>&#x547D;&#x4E2D;&#x8BA1;&#x6570;&#xFF1A;&#x7531;&#x7F13;&#x5B58;&#x63D0;&#x4F9B;&#x54CD;&#x5E94;&#x7684;&#x8BF7;&#x6C42;&#x6570;</li>
</ul>
</blockquote>
<p>Sometimes a request will result in a conditional cache hit. If the cache contains a stale copy of the response, the client will issue a conditional GET. The server will then send either the updated response if it has changed, or a short &#x2018;not modified&#x2019; response if the client&#x2019;s copy is still valid. Such responses increment both the network count and hit count.<br>The best way to improve the cache hit rate is by configuring the web server to return cacheable responses. Although this client honors all <a href="http://www.ietf.org/rfc/rfc2616.txt" target="_blank">HTTP/1.1 (RFC 2068)</a> cache headers, it doesn&#x2019;t cache partial responses.</p>
<p>&#x8BD1;&#xFF1A;&#x6709;&#x65F6;&#xFF0C;&#x8BF7;&#x6C42;&#x5C06;&#x5BFC;&#x81F4;&#x6761;&#x4EF6;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x3002; &#x5982;&#x679C;&#x7F13;&#x5B58;&#x5305;&#x542B;&#x54CD;&#x5E94;&#x7684;&#x9648;&#x65E7;&#x526F;&#x672C;&#xFF0C;&#x5219;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x53D1;&#x51FA;&#x6761;&#x4EF6;GET&#x3002; &#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x526F;&#x672C;&#x4ECD;&#x7136;&#x6709;&#x6548;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x53D1;&#x9001;&#x66F4;&#x65B0;&#x7684;&#x54CD;&#x5E94;&#xFF08;&#x5982;&#x679C;&#x5DF2;&#x66F4;&#x6539;&#xFF09;&#x6216;&#x7B80;&#x77ED;&#x7684;&#x201C;&#x672A;&#x4FEE;&#x6539;&#x201D;&#x54CD;&#x5E94;&#x3002; &#x6B64;&#x7C7B;&#x54CD;&#x5E94;&#x4F1A;&#x589E;&#x52A0;&#x7F51;&#x7EDC;&#x8BA1;&#x6570;&#x548C;&#x547D;&#x4E2D;&#x6B21;&#x6570;&#x3002;
&#x63D0;&#x9AD8;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x7684;&#x6700;&#x4F73;&#x65B9;&#x6CD5;&#x662F;&#x914D;&#x7F6E;Web&#x670D;&#x52A1;&#x5668;&#x4EE5;&#x8FD4;&#x56DE;&#x53EF;&#x7F13;&#x5B58;&#x7684;&#x54CD;&#x5E94;&#x3002; &#x867D;&#x7136;&#x8FD9;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x5C0A;&#x91CD;&#x6240;&#x6709;[HTTP / 1.1 \&#xFF08;RFC 2068 \&#xFF09;]&#xFF08;<a href="http://www.ietf.org/rfc/rfc2616.txt&#xFF09;&#x7F13;&#x5B58;&#x5934;&#xFF0C;&#x4F46;&#x5B83;&#x4E0D;&#x7F13;&#x5B58;&#x90E8;&#x5206;&#x54CD;&#x5E94;&#x3002;" target="_blank">http://www.ietf.org/rfc/rfc2616.txt&#xFF09;&#x7F13;&#x5B58;&#x5934;&#xFF0C;&#x4F46;&#x5B83;&#x4E0D;&#x7F13;&#x5B58;&#x90E8;&#x5206;&#x54CD;&#x5E94;&#x3002;</a></p>
<p><strong>Force a Network Response</strong><br>In some situations, such as after a user clicks a &#x2018;refresh&#x2019; button, it may be necessary to skip the cache, and fetch data directly from the server. To force a full refresh, add the {@code no-cache} directive:</p>
<p>&#x8BD1;&#xFF1A;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F8B;&#x5982;&#x5728;&#x7528;&#x6237;&#x5355;&#x51FB;&#x201C;&#x5237;&#x65B0;&#x201D;&#x6309;&#x94AE;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x8DF3;&#x8FC7;&#x7F13;&#x5B58;&#x5E76;&#x76F4;&#x63A5;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x3002; &#x8981;&#x5F3A;&#x5236;&#x5B8C;&#x5168;&#x5237;&#x65B0;&#xFF0C;&#x8BF7;&#x6DFB;&#x52A0;{@code no-cache}&#x6307;&#x4EE4;&#xFF1A;</p>
<pre><code>connection.addRequestProperty(&quot;Cache-Control&quot;, &quot;no-cache&quot;)
</code></pre><p>If it is only necessary to force a cached response to be validated by the server, use the more efficient {@code max-age=0} instead:</p>
<p>&#x8BD1;&#xFF1A;&#x5982;&#x679C;&#x4EC5;&#x9700;&#x8981;&#x5F3A;&#x5236;&#x7F13;&#x5B58;&#x7684;&#x54CD;&#x5E94;&#x7531;&#x670D;&#x52A1;&#x5668;&#x9A8C;&#x8BC1;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x66F4;&#x6709;&#x6548;&#x7684;{@code max-age = 0}&#xFF1A;</p>
<pre><code>connection.addRequestProperty(&quot;Cache-Control&quot;, &quot;max-age=0&quot;);
</code></pre><p><strong>Force a Cache Response</strong><br>Sometimes you&#x2019;ll want to show resources if they are available immediately, but not otherwise. This can be used so your application can show something while waiting for the latest data to be downloaded. To restrict a request to locally-cached resources, add the {@code only-if-cached} directive:</p>
<p>&#x8BD1;&#xFF1A;&#x6709;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x60F3;&#x7ACB;&#x5373;&#x663E;&#x793A;&#x8D44;&#x6E90;&#x3002; &#x8FD9;&#x4E5F;&#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5FC5;&#x987B;&#x5728;&#x7B49;&#x5F85;&#x6700;&#x65B0;&#x7684;&#x6570;&#x636E;&#x4E0B;&#x8F7D;&#x65F6;&#x663E;&#x793A;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#x3002; &#x8981;&#x9650;&#x5236;&#x5BF9;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x8D44;&#x6E90;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8BF7;&#x6DFB;&#x52A0;{@code only-if-cached}&#x6307;&#x4EE4;&#xFF1A;</p>
<pre><code>try {
    connection.addRequestProperty(&quot;Cache-Control&quot;, &quot;only-if-cached&quot;);
    InputStream cached = connection.getInputStream();
    // the resource was cached! show it
    } catch (FileNotFoundException e) {
    // the resource was not cached
    }
</code></pre><p>This technique works even better in situations where a stale response is better than no response. To permit stale cached responses, use the {@code max-stale} directive with the maximum staleness in seconds:</p>
<p>&#x8BD1;&#xFF1A;&#x8FD9;&#x79CD;&#x6280;&#x672F;&#x5728;&#x9648;&#x65E7;&#x7684;&#x53CD;&#x5E94;&#x6BD4;&#x6CA1;&#x6709;&#x53CD;&#x5E94;&#x66F4;&#x597D;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8FD0;&#x884C;&#x5F97;&#x66F4;&#x597D;&#x3002; &#x8981;&#x5141;&#x8BB8;&#x9648;&#x65E7;&#x7684;&#x7F13;&#x5B58;&#x54CD;&#x5E94;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;{@code max-stale}&#x6307;&#x4EE4;&#xFF0C;&#x5355;&#x4F4D;&#x4E3A;&#x79D2;&#xFF1A;</p>
<pre><code>int maxStale = 60 * 60 * 24 * 28; // tolerate 4-weeks stale
connection.addRequestProperty(&quot;Cache-Control&quot;, &quot;max-stale=&quot; + maxStale);
</code></pre><p><strong>12.OkHttpClient.java</strong><br>Configures and creates HTTP connections. Most applications can use a single OkHttpClient for all of their HTTP requests - benefiting from a shared response cache, thread pool, connection re-use, etc.</p>
<p>&#x8BD1;&#xFF1A;&#x914D;&#x7F6E;&#x548C;&#x521B;&#x5EFA;HTTP&#x8FDE;&#x63A5;&#x3002; &#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5355;&#x4E2A;OkHttpClient&#x6765;&#x5904;&#x7406;&#x6240;&#x6709;&#x7684;HTTP&#x8BF7;&#x6C42; - &#x53D7;&#x76CA;&#x4E8E;&#x5171;&#x4EAB;&#x54CD;&#x5E94;&#x7F13;&#x5B58;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x8FDE;&#x63A5;&#x91CD;&#x7528;&#x7B49;&#x3002;</p>
<p>Instances of OkHttpClient are intended to be fully configured before they&#x2019;re shared - once shared they should be treated as immutable and can safely be used to concurrently open new connections. If required, threads can call <strong>clone</strong> to make a shallow copy of the OkHttpClient that can be safely modified with further configuration changes.</p>
<p>&#x8BD1;&#xFF1A;OkHttpClient&#x7684;&#x5B9E;&#x4F8B;&#x65E8;&#x5728;&#x5728;&#x5171;&#x4EAB;&#x4E4B;&#x524D;&#x5B8C;&#x5168;&#x914D;&#x7F6E; - &#x4E00;&#x65E6;&#x5171;&#x4EAB;&#xFF0C;&#x5B83;&#x4EEC;&#x5E94;&#x88AB;&#x89C6;&#x4E3A;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x5730;&#x7528;&#x4E8E;&#x540C;&#x65F6;&#x6253;&#x5F00;&#x65B0;&#x7684;&#x8FDE;&#x63A5;&#x3002; &#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<strong> clone </strong>&#x6765;&#x521B;&#x5EFA;OkHttpClient&#x7684;&#x6D45;&#x5C42;&#x526F;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x914D;&#x7F6E;&#x66F4;&#x6539;&#x5B89;&#x5168;&#x5730;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002;</p>
<h1 id="&#x8BF7;&#x6C42;&#x6D41;&#x7A0B;&#x56FE;">&#x8BF7;&#x6C42;&#x6D41;&#x7A0B;&#x56FE;</h1>
<p>&#x4E0B;&#x9762;&#x662F;&#x5173;&#x4E8E;OKHttp&#x7684;&#x8BF7;&#x6C42;&#x6D41;&#x7A0B;&#x56FE;<br><a href="http://frodoking.github.io/img/android/okhttp_request_process.png" target="_blank"><img src="http://frodoking.github.io/img/android/okhttp_request_process.png" alt="OKHttp&#x7684;&#x8BF7;&#x6C42;&#x6D41;&#x7A0B;&#x56FE;"></a></p>
<h1 id="&#x8BE6;&#x7EC6;&#x7C7B;&#x5173;&#x7CFB;&#x56FE;">&#x8BE6;&#x7EC6;&#x7C7B;&#x5173;&#x7CFB;&#x56FE;</h1>
<p>&#x7531;&#x4E8E;&#x6574;&#x4E2A;&#x8BBE;&#x8BA1;&#x7C7B;&#x56FE;&#x6BD4;&#x8F83;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x672C;&#x4EBA;&#x5C06;&#x4ECE;&#x6838;&#x5FC3;&#x5165;&#x53E3;client&#x3001;cache&#x3001;interceptor&#x3001;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#x3001;&#x8FDE;&#x63A5;&#x6C60;&#x3001;&#x5E73;&#x53F0;&#x9002;&#x914D;&#x6027;&#x2026;&#x8FD9;&#x4E9B;&#x65B9;&#x9762;&#x6765;&#x9010;&#x4E00;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x6E90;&#x4EE3;&#x7801;&#x7684;&#x8BBE;&#x8BA1;&#x3002;<br>&#x4E0B;&#x9762;&#x662F;&#x6838;&#x5FC3;&#x5165;&#x53E3;OkHttpClient&#x7684;&#x7C7B;&#x8BBE;&#x8BA1;&#x56FE;<br><a href="http://frodoking.github.io/img/android/okhttp_okhttpclient_class.png" target="_blank"><img src="http://frodoking.github.io/img/android/okhttp_okhttpclient_class.png" alt="OkHttpClient&#x7684;&#x7C7B;&#x8BBE;&#x8BA1;&#x56FE;"></a><br>&#x4ECE;OkHttpClient&#x7C7B;&#x7684;&#x6574;&#x4F53;&#x8BBE;&#x8BA1;&#x6765;&#x770B;&#xFF0C;&#x5B83;&#x91C7;&#x7528;&#x95E8;&#x9762;&#x6A21;&#x5F0F;&#x6765;&#x3002;client&#x77E5;&#x6653;&#x5B50;&#x6A21;&#x5757;&#x7684;&#x6240;&#x6709;&#x914D;&#x7F6E;&#x4EE5;&#x53CA;&#x63D0;&#x4F9B;&#x9700;&#x8981;&#x7684;&#x53C2;&#x6570;&#x3002;client&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x59D4;&#x6D3E;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x5B50;&#x7CFB;&#x7EDF;&#x53BB;&#x3002;<br>&#x5728;&#x8BE5;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6709;&#x591A;&#x4E2A;&#x5B50;&#x7CFB;&#x7EDF;&#x3001;&#x7C7B;&#x6216;&#x8005;&#x7C7B;&#x7684;&#x96C6;&#x5408;&#x3002;&#x4F8B;&#x5982;&#x4E0A;&#x9762;&#x7684;cache&#x3001;&#x8FDE;&#x63A5;&#x4EE5;&#x53CA;&#x8FDE;&#x63A5;&#x6C60;&#x76F8;&#x5173;&#x7C7B;&#x7684;&#x96C6;&#x5408;&#x3001;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#x76F8;&#x5173;&#x7C7B;&#x96C6;&#x5408;&#x7B49;&#x7B49;&#x3002;&#x6BCF;&#x4E2A;&#x5B50;&#x7CFB;&#x7EDF;&#x90FD;&#x53EF;&#x4EE5;&#x88AB;&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#xFF0C;&#x6216;&#x8005;&#x88AB;&#x95E8;&#x9762;&#x89D2;&#x8272;&#x8C03;&#x7528;&#x3002;&#x5B50;&#x7CFB;&#x7EDF;&#x5E76;&#x4E0D;&#x77E5;&#x9053;&#x95E8;&#x9762;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x5BF9;&#x4E8E;&#x5B50;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;&#x95E8;&#x9762;&#x4EC5;&#x4EC5;&#x662F;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x800C;&#x5DF2;&#x3002;&#x540C;&#x65F6;&#xFF0C;OkHttpClient&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x6574;&#x4E2A;&#x6846;&#x67B6;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002;<br>&#x901A;&#x8FC7;&#x7C7B;&#x56FE;&#xFF0C;&#x5176;&#x5B9E;&#x5F88;&#x660E;&#x663E;&#x53CD;&#x5E94;&#x4E86;&#x8BE5;&#x6846;&#x67B6;&#x7684;&#x51E0;&#x5927;&#x6838;&#x5FC3;&#x5B50;&#x7CFB;&#x7EDF;&#xFF1B;&#x8DEF;&#x7531;&#x3001;&#x8FDE;&#x63A5;&#x534F;&#x8BAE;&#x3001;&#x62E6;&#x622A;&#x5668;&#x3001;&#x4EE3;&#x7406;&#x3001;&#x5B89;&#x5168;&#x6027;&#x8BA4;&#x8BC1;&#x3001;&#x8FDE;&#x63A5;&#x6C60;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#x9002;&#x914D;&#x3002;&#x4ECE;client&#x5927;&#x5927;&#x964D;&#x4F4E;&#x4E86;&#x5F00;&#x53D1;&#x8005;&#x4F7F;&#x7528;&#x96BE;&#x5EA6;&#x3002;&#x540C;&#x65F6;&#x975E;&#x5E38;&#x660E;&#x4E86;&#x7684;&#x5C55;&#x793A;&#x4E86;&#x8BE5;&#x6846;&#x67B6;&#x5728;&#x6240;&#x6709;&#x9700;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x4EE5;&#x53CA;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x51E0;&#x4E2A;Section&#x4E2D;&#x5C06;&#x4F1A;&#x7ED3;&#x5408;&#x5B50;&#x6A21;&#x5757;&#x6838;&#x5FC3;&#x7C7B;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x4ECE;&#x8BE5;&#x6846;&#x67B6;&#x7684;&#x6574;&#x4F53;&#x7279;&#x6027;&#x4E0A;&#x6765;&#x5206;&#x6790;&#x8FD9;&#x4E9B;&#x6A21;&#x5757;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x5404;&#x81EA;&#x529F;&#x80FD;&#x3002;&#x4EE5;&#x53CA;&#x5404;&#x4E2A;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x662F;&#x5982;&#x4F55;&#x76F8;&#x4E92;&#x914D;&#x5408;&#x6765;&#x5B8C;&#x6210;&#x5BA2;&#x6237;&#x7AEF;&#x5404;&#x79CD;&#x590D;&#x6742;&#x8BF7;&#x6C42;&#x3002;</p>
<h1 id="&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7684;&#x5B9E;&#x73B0;">&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#x7684;&#x5B9E;&#x73B0;</h1>
<p>&#x5728;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x6574;&#x4E2A;&#x6846;&#x67B6;&#x4E3B;&#x8981;&#x901A;&#x8FC7;Call&#x6765;&#x5C01;&#x88C5;&#x6BCF;&#x4E00;&#x6B21;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x540C;&#x65F6;Call&#x6301;&#x6709;OkHttpClient&#x548C;&#x4E00;&#x4EFD;HttpEngine&#x3002;&#x800C;&#x6BCF;&#x4E00;&#x6B21;&#x7684;&#x540C;&#x6B65;&#x6216;&#x8005;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x6709;Dispatcher&#x7684;&#x53C2;&#x4E0E;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF1A;</p>
<blockquote>
<ul>
<li>&#x540C;&#x6B65;
Dispatcher&#x4F1A;&#x5728;&#x540C;&#x6B65;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x88AB;&#x6267;&#x884C;&#x8FC7;&#x5F97;&#x4EFB;&#x52A1;Call&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2D;&#x53BB;&#x6267;&#x884C;Call&#x7684;getResponseWithInterceptorChain&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#xFF0C;&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7684;&#x8FD4;&#x56DE;&#x6570;&#x636E;Response&#xFF1B;</li>
<li>&#x5F02;&#x6B65;
&#x9996;&#x5148;&#x6765;&#x8BF4;&#x4E00;&#x4E0B;Dispatcher&#xFF0C;Dispatcher&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x4E86;&#x61D2;&#x52A0;&#x8F7D;&#x65E0;&#x8FB9;&#x754C;&#x9650;&#x5236;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x65B9;&#x5F0F;&#xFF0C;&#x540C;&#x65F6;&#x8BE5;&#x7EBF;&#x7A0B;&#x6C60;&#x91C7;&#x7528;&#x4E86;SynchronousQueue&#x8FD9;&#x79CD;&#x963B;&#x585E;&#x961F;&#x5217;&#x3002;SynchronousQueue&#x6BCF;&#x4E2A;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x53E6;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x79FB;&#x9664;&#x64CD;&#x4F5C;&#xFF0C;&#x540C;&#x6837;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x79FB;&#x9664;&#x64CD;&#x4F5C;&#x90FD;&#x7B49;&#x5F85;&#x53E6;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x3002;&#x56E0;&#x6B64;&#x6B64;&#x961F;&#x5217;&#x5185;&#x90E8;&#x5176; &#x5B9E;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x5BB9;&#x91CF;&#x662F;0&#xFF0C;&#x4E25;&#x683C;&#x8BF4;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x79CD;&#x5BB9;&#x5668;&#x3002;&#x7531;&#x4E8E;&#x961F;&#x5217;&#x6CA1;&#x6709;&#x5BB9;&#x91CF;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x80FD;&#x8C03;&#x7528;peek&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x79FB;&#x9664;&#x5143;&#x7D20;&#x65F6;&#x624D;&#x6709;&#x5143;&#x7D20;&#x3002;&#x663E;&#x7136;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x5FEB;&#x901F;&#x4F20;&#x9012;&#x5143;&#x7D20;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5143;&#x7D20;&#x603B;&#x662F;&#x4EE5;&#x6700;&#x5FEB;&#x7684;&#x65B9;&#x5F0F;&#x4ECE;&#x63D2;&#x5165;&#x8005;&#xFF08;&#x751F;&#x4EA7;&#x8005;&#xFF09;&#x4F20;&#x9012;&#x7ED9;&#x79FB;&#x9664;&#x8005;&#xFF08;&#x6D88;&#x8D39;&#x8005;&#xFF09;&#xFF0C;&#x8FD9;&#x5728;&#x591A;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x662F;&#x6700;&#x5FEB;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x5BF9;&#x4E8E;&#x9AD8;&#x9891;&#x7E41;&#x8BF7;&#x6C42;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x65E0;&#x7591;&#x662F;&#x6700;&#x9002;&#x5408;&#x7684;&#x3002;
&#x5F02;&#x6B65;&#x6267;&#x884C;&#x662F;&#x901A;&#x8FC7;Call.enqueue(Callback responseCallback)&#x6765;&#x6267;&#x884C;&#xFF0C;&#x5728;Dispatcher&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5C01;&#x88C5;&#x4E86;Callback&#x7684;Call&#x7684;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;Runnable&#x6765;&#x6267;&#x884C;&#x5F53;&#x524D;&#x7684;Call&#x3002;&#x8FD9;&#x91CC;&#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#x8FD9;&#x4E2A;AsyncCall&#x662F;Call&#x7684;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x3002;AsyncCall&#x7684;execute&#x65B9;&#x6CD5;&#x4ECD;&#x7136;&#x4F1A;&#x56DE;&#x8C03;&#x5230;Call&#x7684;getResponseWithInterceptorChain&#x65B9;&#x6CD5;&#x6765;&#x5B8C;&#x6210;&#x8BF7;&#x6C42;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x6216;&#x8005;&#x72B6;&#x6001;&#x901A;&#x8FC7;Callback&#x6765;&#x5B8C;&#x6210;&#x3002;</li>
</ul>
</blockquote>
<p>&#x63A5;&#x4E0B;&#x6765;&#x7EE7;&#x7EED;&#x8BB2;&#x8BB2;Call&#x7684;getResponseWithInterceptorChain&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x8FB9;&#x91CD;&#x70B9;&#x8BF4;&#x4E00;&#x4E0B;&#x62E6;&#x622A;&#x5668;&#x94FE;&#x6761;&#x7684;&#x5B9E;&#x73B0;&#x4EE5;&#x53CA;&#x4F5C;&#x7528;&#x3002;</p>
<h1 id="&#x62E6;&#x622A;&#x5668;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;">&#x62E6;&#x622A;&#x5668;&#x6709;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;</h1>
<p>&#x5148;&#x6765;&#x770B;&#x770B;Interceptor&#x672C;&#x8EAB;&#x7684;&#x6587;&#x6863;&#x89E3;&#x91CA;&#xFF1A;&#x89C2;&#x5BDF;&#xFF0C;&#x4FEE;&#x6539;&#x4EE5;&#x53CA;&#x53EF;&#x80FD;&#x77ED;&#x8DEF;&#x7684;&#x8BF7;&#x6C42;&#x8F93;&#x51FA;&#x548C;&#x54CD;&#x5E94;&#x8BF7;&#x6C42;&#x7684;&#x56DE;&#x6765;&#x3002;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x62E6;&#x622A;&#x5668;&#x7528;&#x6765;&#x6DFB;&#x52A0;&#xFF0C;&#x79FB;&#x9664;&#x6216;&#x8005;&#x8F6C;&#x6362;&#x8BF7;&#x6C42;&#x6216;&#x8005;&#x56DE;&#x5E94;&#x7684;&#x5934;&#x90E8;&#x4FE1;&#x606F;&#x3002;<br>&#x62E6;&#x622A;&#x5668;&#x63A5;&#x53E3;&#x4E2D;&#x6709;intercept(Chain chain)&#x65B9;&#x6CD5;&#xFF0C;&#x540C;&#x65F6;&#x8FD4;&#x56DE;Response&#x3002;&#x6240;&#x8C13;&#x62E6;&#x622A;&#x5668;&#x66F4;&#x50CF;&#x662F;AOP&#xFF08;&#x9762;&#x5411;&#x5207;&#x9762;&#x7F16;&#x7A0B;&#xFF09;&#x8BBE;&#x8BA1;&#x7684;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x3002;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E00;&#x4E2A;okhttp&#x6E90;&#x7801;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5F15;&#x5BFC;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#x660E;&#x62E6;&#x622A;&#x5668;&#x7684;&#x4F5C;&#x7528;&#x3002;</p>
<pre><code>public final class LoggingInterceptors {
  private static final Logger logger = Logger.getLogger(LoggingInterceptors.class.getName());
  private final OkHttpClient client = new OkHttpClient();

  public LoggingInterceptors() {
    client.networkInterceptors().add(new Interceptor() {
      @Override public Response intercept(Chain chain) throws IOException {
        long t1 = System.nanoTime();
        Request request = chain.request();
        logger.info(String.format(&quot;Sending request %s on %s%n%s&quot;,
            request.url(), chain.connection(), request.headers()));
        Response response = chain.proceed(request);

        long t2 = System.nanoTime();
        logger.info(String.format(&quot;Received response for %s in %.1fms%n%s&quot;,
            request.url(), (t2 - t1) / 1e6d, response.headers()));
        return response;
      }
    });
  }

  public void run() throws Exception {
    Request request = new Request.Builder()
        .url(&quot;https://publicobject.com/helloworld.txt&quot;)
        .build();

    Response response = client.newCall(request).execute();
    response.body().close();
  }

  public static void main(String... args) throws Exception {
    new LoggingInterceptors().run();
  }
}
</code></pre><p>&#x8FD4;&#x56DE;&#x4FE1;&#x606F;</p>
<pre><code>&#x4E09;&#x6708; 19, 2015 2:11:29 &#x4E0B;&#x5348; com.squareup.okhttp.recipes.LoggingInterceptors$1 intercept
&#x4FE1;&#x606F;: Sending request https://publicobject.com/helloworld.txt on Connection{publicobject.com:443, proxy=DIRECT hostAddress=54.187.32.157 cipherSuite=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA protocol=http/1.1}
Host: publicobject.com 
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: 

&#x4E09;&#x6708; 19, 2015 2:11:30 &#x4E0B;&#x5348; com.squareup.okhttp.recipes.LoggingInterceptors$1 intercept
&#x4FE1;&#x606F;: Received response for https://publicobject.com/helloworld.txt in 275.9ms
Server: nginx/1.4.6 (Ubuntu)
Date: Thu, 19 Mar 2015 06:08:50 GMT
Content-Type: text/plain
Content-Length: 1759
Last-Modified: Tue, 27 May 2014 02:35:47 GMT
Connection: keep-alive
ETag: &quot;5383fa03-6df&quot;
Accept-Ranges: bytes
OkHttp-Selected-Protocol: http/1.1
OkHttp-Sent-Millis: 1426745489953
OkHttp-Received-Millis: 1426745490198
</code></pre><p>&#x4ECE;&#x8FD9;&#x91CC;&#x7684;&#x6267;&#x884C;&#x6765;&#x770B;&#xFF0C;&#x62E6;&#x622A;&#x5668;&#x4E3B;&#x8981;&#x662F;&#x9488;&#x5BF9;Request&#x548C;Response&#x7684;&#x5207;&#x9762;&#x5904;&#x7406;&#x3002;<br>&#x90A3;&#x518D;&#x6765;&#x770B;&#x770B;&#x6E90;&#x7801;&#x5230;&#x5E95;&#x5728;&#x4EC0;&#x4E48;&#x4F4D;&#x7F6E;&#x505A;&#x7684;&#x8FD9;&#x4E2A;&#x5904;&#x7406;&#x5462;&#xFF1F;&#x4E3A;&#x4E86;&#x66F4;&#x52A0;&#x76F4;&#x89C2;&#x7684;&#x53CD;&#x5E94;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#xFF0C;&#x672C;&#x4EBA;&#x622A;&#x56FE;&#x4E86;&#x4E00;&#x4E0B;&#x6267;&#x884C;&#x5806;&#x6808;<br><a href="http://frodoking.github.io/img/android/okhttp_interceptor_running_stack.png" target="_blank"><img src="http://frodoking.github.io/img/android/okhttp_interceptor_running_stack.png" alt="OKHttp&#x603B;&#x4F53;&#x8BBE;&#x8BA1;&#x56FE;"></a><br>&#x53E6;&#x5916;&#x5982;&#x679C;&#x8FD8;&#x6709;&#x540C;&#x5B66;&#x5BF9;Interceptor&#x6BD4;&#x8F83;&#x6562;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x53BB;&#x6E90;&#x7801;&#x7684;simples&#x6A21;&#x5757;&#x770B;&#x770B;GzipRequestInterceptor.java&#x9488;&#x5BF9;HTTP request body&#x7684;&#x4E00;&#x4E2A;zip&#x538B;&#x7F29;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x91CC;&#x518D;&#x591A;&#x8BF4;&#x4E00;&#x4E0B;&#x5173;&#x4E8E;Call&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5728;Call&#x4E2D;&#x6301;&#x6709;&#x4E00;&#x4E2A;HttpEngine&#x3002;&#x6BCF;&#x4E00;&#x4E2A;&#x4E0D;&#x540C;&#x7684;Call&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x7684;HttpEngine&#x3002;&#x5728;HttpEngine&#x4E2D;&#x4E3B;&#x8981;&#x662F;&#x5404;&#x79CD;&#x94FE;&#x8DEF;&#x548C;&#x5730;&#x5740;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;Transport&#x6BD4;&#x8F83;&#x91CD;&#x8981;</p>
<h1 id="&#x7F13;&#x5B58;&#x7B56;&#x7565;">&#x7F13;&#x5B58;&#x7B56;&#x7565;</h1>
<p>&#x5728;OkHttpClient&#x5185;&#x90E8;&#x66B4;&#x9732;&#x4E86;&#x6709;Cache&#x548C;InternalCache&#x3002;&#x800C;InternalCache&#x4E0D;&#x5E94;&#x8BE5;&#x624B;&#x52A8;&#x53BB;&#x521B;&#x5EFA;&#xFF0C;&#x6240;&#x4EE5;&#x4F5C;&#x4E3A;&#x5F00;&#x53D1;&#x4F7F;&#x7528;&#x8005;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x822C;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>public final class CacheResponse {
  private static final Logger logger = Logger.getLogger(LoggingInterceptors.class.getName());
  private final OkHttpClient client;

  public CacheResponse(File cacheDirectory) throws Exception {
    logger.info(String.format(&quot;Cache file path %s&quot;,cacheDirectory.getAbsoluteFile()));
    int cacheSize = 10 * 1024 * 1024; // 10 MiB
    Cache cache = new Cache(cacheDirectory, cacheSize);

    client = new OkHttpClient();
    client.setCache(cache);
  }

  public void run() throws Exception {
    Request request = new Request.Builder()
        .url(&quot;http://publicobject.com/helloworld.txt&quot;)
        .build();

    Response response1 = client.newCall(request).execute();
    if (!response1.isSuccessful()) throw new IOException(&quot;Unexpected code &quot; + response1);

    String response1Body = response1.body().string();
    System.out.println(&quot;Response 1 response:          &quot; + response1);
    System.out.println(&quot;Response 1 cache response:    &quot; + response1.cacheResponse());
    System.out.println(&quot;Response 1 network response:  &quot; + response1.networkResponse());

    Response response2 = client.newCall(request).execute();
    if (!response2.isSuccessful()) throw new IOException(&quot;Unexpected code &quot; + response2);

    String response2Body = response2.body().string();
    System.out.println(&quot;Response 2 response:          &quot; + response2);
    System.out.println(&quot;Response 2 cache response:    &quot; + response2.cacheResponse());
    System.out.println(&quot;Response 2 network response:  &quot; + response2.networkResponse());

    System.out.println(&quot;Response 2 equals Response 1? &quot; + response1Body.equals(response2Body));
  }

  public static void main(String... args) throws Exception {
    new CacheResponse(new File(&quot;CacheResponse.tmp&quot;)).run();
  }
}
</code></pre><p>&#x8FD4;&#x56DE;&#x4FE1;&#x606F;</p>
<pre><code>&#x4FE1;&#x606F;: Cache file path D:\work\workspaces\workspaces_intellij\workspace_opensource\okhttp\CacheResponse.tmp
Response 1 response:          Response{protocol=http/1.1, code=200, message=OK, url=https://publicobject.com/helloworld.txt}
Response 1 cache response:    null
Response 1 network response:  Response{protocol=http/1.1, code=200, message=OK, url=https://publicobject.com/helloworld.txt}
Response 2 response:          Response{protocol=http/1.1, code=200, message=OK, url=https://publicobject.com/helloworld.txt}
Response 2 cache response:    Response{protocol=http/1.1, code=200, message=OK, url=https://publicobject.com/helloworld.txt}
Response 2 network response:  null
Response 2 equals Response 1? true

Process finished with exit code 0
</code></pre><p>&#x4E0A;&#x8FB9;&#x8FD9;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x540C;&#x6837;&#x6765;&#x4E4B;&#x4E8E;simple&#x4EE3;&#x7801;CacheResponse.java&#xFF0C;&#x53CD;&#x9988;&#x56DE;&#x6765;&#x7684;&#x6570;&#x636E;&#x91CD;&#x70B9;&#x770B;&#x4E00;&#x4E0B;&#x7F13;&#x5B58;&#x65E5;&#x5FD7;&#x3002;&#x7B2C;&#x4E00;&#x6B21;&#x662F;&#x6765;&#x81F3;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x6765;&#x81F3;&#x7F13;&#x5B58;&#x3002;<br>&#x90A3;&#x5728;&#x8FD9;&#x4E00;&#x8282;&#x91CD;&#x70B9;&#x8BF4;&#x4E00;&#x4E0B;&#x6574;&#x4E2A;&#x6846;&#x67B6;&#x7684;&#x7F13;&#x5B58;&#x7B56;&#x7565;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x91CC;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#x8BB2;&#x5230;&#x7684;&#x8FD0;&#x884C;&#x5806;&#x6808;&#x56FE;&#x3002;&#x4ECE;Call.getResponse(Request request, boolean forWebSocket)&#x6267;&#x884C;Engine.sendRequest()&#x548C;Engine.readResponse()&#x6765;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x4E00;&#x4E0B;&#x3002;</p>
<p><strong>sendRequest()</strong><br>&#x6B64;&#x65B9;&#x6CD5;&#x662F;&#x5BF9;&#x53EF;&#x80FD;&#x7684;Response&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x9884;&#x5224;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x5C31;&#x4F1A;&#x5F00;&#x542F;&#x4E00;&#x4E2A;socket&#x6765;&#x83B7;&#x53D6;&#x8D44;&#x6E90;&#x3002;&#x5982;&#x679C;&#x8BF7;&#x6C42;&#x5B58;&#x5728;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x4E3A;&#x5F53;&#x524D;request&#x6DFB;&#x52A0;&#x8BF7;&#x6C42;&#x5934;&#x90E8;&#x5E76;&#x4E14;&#x51C6;&#x5907;&#x5F00;&#x59CB;&#x5199;&#x5165;request body&#x3002;</p>
<pre><code>public void sendRequest() throws IOException {
        if (cacheStrategy != null) {
            return; // Already sent.
        }
        if (transport != null) {
            throw new IllegalStateException();
        }

        //&#x586B;&#x5145;&#x9ED8;&#x8BA4;&#x7684;&#x8BF7;&#x6C42;&#x5934;&#x90E8;&#x548C;&#x4E8B;&#x52A1;&#x3002;
        Request request = networkRequest(userRequest);

        //&#x4E0B;&#x9762;&#x4E00;&#x884C;&#x5F88;&#x91CD;&#x8981;,&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x53BB;&#x83B7;&#x53D6;client&#x4E2D;&#x7684;Cache&#x3002;&#x540C;&#x65F6;Cache&#x5728;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x53BB;&#x8BFB;&#x53D6;&#x7F13;&#x5B58;&#x76EE;&#x5F55;&#x4E2D;&#x5173;&#x4E8E;&#x66FE;&#x7ECF;&#x8BF7;&#x6C42;&#x8FC7;&#x7684;&#x6240;&#x6709;&#x4FE1;&#x606F;&#x3002;
        InternalCache responseCache = Internal.instance.internalCache(client);
        Response cacheCandidate = responseCache != null? responseCache.get(request): null;

        long now = System.currentTimeMillis();
        //&#x7F13;&#x5B58;&#x7B56;&#x7565;&#x4E2D;&#x7684;&#x5404;&#x79CD;&#x914D;&#x7F6E;&#x7684;&#x5C01;&#x88C5;
        cacheStrategy = new CacheStrategy.Factory(now, request, cacheCandidate).get();
        networkRequest = cacheStrategy.networkRequest;
        cacheResponse = cacheStrategy.cacheResponse;

        if (responseCache != null) {
            //&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x662F;&#x6765;&#x81F3;&#x7F51;&#x7EDC;&#x8FD8;&#x662F;&#x547D;&#x4E2D;&#x4E86;&#x7F13;&#x5B58;
            responseCache.trackResponse(cacheStrategy);
        }

        if (cacheCandidate != null &amp;&amp; cacheResponse == null) {
            closeQuietly(cacheCandidate.body()); // The cache candidate wasn&apos;t applicable. Close it.
        }

        if (networkRequest != null) {
            // Open a connection unless we inherited one from a redirect.
            if (connection == null) {
                //&#x8FDE;&#x63A5;&#x5230;&#x670D;&#x52A1;&#x5668;&#x3001;&#x91CD;&#x5B9A;&#x5411;&#x670D;&#x52A1;&#x5668;&#x6216;&#x8005;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;Connect to the origin server either directly or via a proxy.
                connect();
            }
            //&#x901A;&#x8FC7;Connection&#x521B;&#x5EFA;&#x4E00;&#x4E2A;SpdyTransport&#x6216;&#x8005;HttpTransport
            transport = Internal.instance.newTransport(connection, this);
            ...
        } else {
            ...
        }
    }
</code></pre><p><strong>readResponse()</strong><br>&#x6B64;&#x65B9;&#x6CD5;&#x53D1;&#x8D77;&#x5237;&#x65B0;&#x8BF7;&#x6C42;&#x5934;&#x90E8;&#x548C;&#x8BF7;&#x6C42;&#x4F53;&#xFF0C;&#x89E3;&#x6790;HTTP&#x56DE;&#x5E94;&#x5934;&#x90E8;&#xFF0C;&#x5E76;&#x4E14;&#x5982;&#x679C;HTTP&#x56DE;&#x5E94;&#x4F53;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#x5C31;&#x5F00;&#x59CB;&#x8BFB;&#x53D6;&#x5F53;&#x524D;&#x56DE;&#x5E94;&#x5934;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x6709;&#x53D1;&#x8D77;&#x8FD4;&#x56DE;&#x5B58;&#x5165;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E5F;&#x6709;&#x8FD4;&#x56DE;&#x548C;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x5BF9;&#x6BD4;&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p>
<pre><code>public void readResponse() throws IOException {
        ...
        Response networkResponse;

        if (forWebSocket) {
            ...
        } else if (!callerWritesRequestBody) {
            // &#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x662F;&#x770B;&#x5F53;&#x524D;&#x7684;&#x8BF7;&#x6C42;body&#xFF0C;&#x5176;&#x5B9E;&#x771F;&#x6B63;&#x8BF7;&#x6C42;&#x662F;&#x5728;&#x8FD9;&#x91CC;&#x53D1;&#x751F;&#x7684;&#x3002;
            // &#x5728;readNetworkResponse()&#x65B9;&#x6CD5;&#x4E2D;&#x6267;&#x884C;transport.finishRequest()
            // &#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x8BE5;&#x65B9;&#x6CD5;&#x5185;&#x90E8;&#x4F1A;&#x8C03;&#x7528;&#x5230;HttpConnection.flush()&#x65B9;&#x6CD5;
            networkResponse = new NetworkInterceptorChain(0, networkRequest).proceed(networkRequest);
        } else {
            ...
        }
        //&#x5BF9;Response&#x5934;&#x90E8;&#x4E8B;&#x52A1;&#x5B58;&#x5165;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x4E2D;
        receiveHeaders(networkResponse.headers());

        // If we have a cache response too, then we&apos;re doing a conditional get.
        if (cacheResponse != null) {
            //&#x68C0;&#x67E5;&#x7F13;&#x5B58;&#x662F;&#x5426;&#x53EF;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x53EF;&#x7528;&#x3002;&#x90A3;&#x4E48;&#x5C31;&#x7528;&#x5F53;&#x524D;&#x7F13;&#x5B58;&#x7684;Response&#xFF0C;&#x5173;&#x95ED;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#xFF0C;&#x91CA;&#x653E;&#x8FDE;&#x63A5;&#x3002;
            if (validate(cacheResponse, networkResponse)) {
                userResponse = cacheResponse.newBuilder()
                        .request(userRequest)
                        .priorResponse(stripBody(priorResponse))
                        .headers(combine(cacheResponse.headers(), networkResponse.headers()))
                        .cacheResponse(stripBody(cacheResponse))
                        .networkResponse(stripBody(networkResponse))
                        .build();
                networkResponse.body().close();
                releaseConnection();

                // Update the cache after combining headers but before stripping the
                // Content-Encoding header (as performed by initContentStream()).
                // &#x66F4;&#x65B0;&#x7F13;&#x5B58;&#x4EE5;&#x53CA;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x60C5;&#x51B5;
                InternalCache responseCache = Internal.instance.internalCache(client);
                responseCache.trackConditionalCacheHit();
                responseCache.update(cacheResponse, stripBody(userResponse));
                // unzip&#x89E3;&#x538B;&#x7F29;response
                userResponse = unzip(userResponse);
                return;
            } else {
                closeQuietly(cacheResponse.body());
            }
        }

        userResponse = networkResponse.newBuilder()
                .request(userRequest)
                .priorResponse(stripBody(priorResponse))
                .cacheResponse(stripBody(cacheResponse))
                .networkResponse(stripBody(networkResponse))
                .build();

        //&#x53D1;&#x8D77;&#x7F13;&#x5B58;&#x7684;&#x5730;&#x65B9;
        if (hasBody(userResponse)) {
            maybeCache();
            userResponse = unzip(cacheWritingResponse(storeRequest, userResponse));
        }
    }
</code></pre><h1 id="http&#x8FDE;&#x63A5;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF08;&#x8BF4;&#x8BF4;&#x8FDE;&#x63A5;&#x6C60;&#xFF09;">HTTP&#x8FDE;&#x63A5;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF08;&#x8BF4;&#x8BF4;&#x8FDE;&#x63A5;&#x6C60;&#xFF09;</h1>
<p>&#x5916;&#x90E8;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x5165;&#x53E3;&#x90FD;&#x662F;&#x901A;&#x8FC7;Transport&#x63A5;&#x53E3;&#x6765;&#x5B8C;&#x6210;&#x3002;&#x8BE5;&#x7C7B;&#x91C7;&#x7528;&#x4E86;&#x6865;&#x63A5;&#x6A21;&#x5F0F;&#x5C06;HttpEngine&#x548C;HttpConnection&#x6765;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#x3002;&#x56E0;&#x4E3A;HttpEngine&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x903B;&#x8F91;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x4E5F;&#x5145;&#x5F53;&#x4E86;&#x8BF7;&#x6C42;&#x914D;&#x7F6E;&#x7684;&#x63D0;&#x4F9B;&#x5F15;&#x64CE;&#xFF0C;&#x800C;HttpConnection&#x662F;&#x5BF9;&#x5E95;&#x5C42;&#x5904;&#x7406;Connection&#x7684;&#x5C01;&#x88C5;&#x3002;</p>
<p>OK&#x73B0;&#x5728;&#x91CD;&#x70B9;&#x8F6C;&#x79FB;&#x5230;HttpConnection&#xFF08;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x53D1;&#x9001;HTTP/1.1&#x4FE1;&#x606F;&#x7684;socket&#x8FDE;&#x63A5;&#xFF09;&#x8FD9;&#x91CC;&#x3002;&#x4E3B;&#x8981;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF1A;</p>
<blockquote>
<p>1&#x3001;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x5934;&#xFF1B;<br>2&#x3001;&#x6253;&#x5F00;&#x4E00;&#x4E2A;sink(io&#x4E2D;&#x6709;&#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x6216;&#x8005;&#x5757;&#x7ED3;&#x6784;chunked&#x65B9;&#x5F0F;&#x7684;)&#x53BB;&#x5199;&#x5165;&#x8BF7;&#x6C42;body&#xFF1B;<br>3&#x3001;&#x5199;&#x5165;&#x5E76;&#x4E14;&#x5173;&#x95ED;sink&#xFF1B;<br>4&#x3001;&#x8BFB;&#x53D6;Response&#x5934;&#x90E8;&#xFF1B;<br>5&#x3001;&#x6253;&#x5F00;&#x4E00;&#x4E2A;source&#xFF08;&#x5BF9;&#x5E94;&#x5230;&#x7B2C;2&#x6B65;&#x7684;sink&#x65B9;&#x5F0F;&#xFF09;&#x53BB;&#x8BFB;&#x53D6;Response&#x7684;body&#xFF1B;<br>6&#x3001;&#x8BFB;&#x53D6;&#x5E76;&#x5173;&#x95ED;source&#xFF1B;</p>
</blockquote>
<p>&#x4E0B;&#x8FB9;&#x770B;&#x4E00;&#x5F20;&#x5173;&#x4E8E;&#x8FDE;&#x63A5;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5E8F;&#x56FE;&#xFF1A;<br><a href="http://frodoking.github.io/img/android/okhttp_connection_lifecycle.png" target="_blank"><img src="http://frodoking.github.io/img/android/okhttp_connection_lifecycle.png" alt="OKHttp&#x8FDE;&#x63A5;&#x6267;&#x884C;&#x65F6;&#x5E8F;&#x56FE;"></a><br>&#x8FD9;&#x5F20;&#x56FE;&#x753B;&#x5F97;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x8BE6;&#x7EC6;&#x7684;&#x8FC7;&#x7A0B;&#x4EE5;&#x53CA;&#x8FDE;&#x63A5;&#x6C60;&#x7684;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x5927;&#x81F4;&#x8BF4;&#x660E;&#x4E00;&#x4E0B;&#xFF1A;</p>
<blockquote>
<p>1&#x3001;&#x8FDE;&#x63A5;&#x6C60;&#x662F;&#x66B4;&#x9732;&#x5728;client&#x4E0B;&#x7684;&#xFF0C;&#x5B83;&#x8D2F;&#x7A7F;&#x4E86;Transport&#x3001;HttpEngine&#x3001;Connection&#x3001;HttpConnection&#x548C;SpdyConnection&#xFF1B;&#x5728;&#x8FD9;&#x91CC;&#x76EE;&#x524D;&#x9ED8;&#x8BA4;&#x8BA8;&#x8BBA;HttpConnection&#xFF1B;<br>2&#x3001;ConnectionPool&#x6709;&#x4E24;&#x4E2A;&#x6784;&#x5EFA;&#x53C2;&#x6570;&#x662F;maxIdleConnections&#xFF08;&#x6700;&#x5927;&#x7A7A;&#x95F2;&#x8FDE;&#x63A5;&#x6570;&#xFF09;&#x548C;keepAliveDurationNs&#xFF08;&#x5B58;&#x6D3B;&#x65F6;&#x95F4;&#xFF09;,&#x53E6;&#x5916;&#x8FDE;&#x63A5;&#x6C60;&#x9ED8;&#x8BA4;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x91C7;&#x7528;&#x4E86;Single&#x7684;&#x6A21;&#x5F0F;&#xFF08;&#x6E90;&#x7801;&#x89E3;&#x91CA;&#x662F;&#xFF1A;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x6E05;&#x7406;&#x8FC7;&#x671F;&#x7684;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#xFF0C;&#x6700;&#x591A;&#x4E00;&#x4E2A;&#x5355;&#x7EBF;&#x7A0B;&#x53BB;&#x8FD0;&#x884C;&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x6C60;&#xFF09;&#xFF1B;<br>3&#x3001;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x662F;&#x5728;Connection.connect()&#x8FD9;&#x91CC;&#xFF0C;&#x5B9E;&#x9645;&#x6267;&#x884C;&#x662F;&#x5728;HttpConnection.flush()&#x8FD9;&#x91CC;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x5237;&#x5165;&#x3002;&#x8FD9;&#x91CC;&#x91CD;&#x70B9;&#x5E94;&#x8BE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;sink&#x548C;source&#xFF0C;&#x4ED6;&#x4EEC;&#x521B;&#x5EFA;&#x7684;&#x9ED8;&#x8BA4;&#x65B9;&#x5F0F;&#x90FD;&#x662F;&#x4F9D;&#x6258;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;socket&#xFF1A;<br>this.source = Okio.buffer(Okio.source(socket));<br>this.sink = Okio.buffer(Okio.sink(socket));<br>&#x5982;&#x679C;&#x518D;&#x8FDB;&#x4E00;&#x6B65;&#x770B;&#x4E00;&#x4E0B;io&#x7684;&#x6E90;&#x7801;&#x5C31;&#x80FD;&#x770B;&#x5230;&#xFF1A;<br>Source source = source((InputStream)socket.getInputStream(), (Timeout)timeout);<br>Sink sink = sink((OutputStream)socket.getOutputStream(), (Timeout)timeout);<br>&#x8FD9;&#x4E0B;&#x6211;&#x60F3;&#x5927;&#x5BB6;&#x90FD;&#x5E94;&#x8BE5;&#x660E;&#x767D;&#x8FD9;&#x91CC;&#x5230;&#x5E95;&#x662F;&#x771F;&#x4E48;&#x56DE;&#x4E8B;&#x513F;&#x4E86;&#x5427;&#xFF1F;<br>&#x76F8;&#x5173;&#x7684;sink&#x548C;source&#x8FD8;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x7EC6;&#x5206;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x670B;&#x53CB;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6DF1;&#x5165;&#x770B;&#x4E00;&#x4E0B;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x6DF1;&#x5165;&#x4E86;&#x3002;&#x4E0D;&#x7136;&#x771F;&#x7684;&#x8BF4;&#x4E0D;&#x5B8C;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
</blockquote>
<p>&#x5176;&#x5B9E;&#x8FDE;&#x63A5;&#x6C60;&#x8FD9;&#x91CC;&#x8FD8;&#x662F;&#x6709;&#x5F88;&#x591A;&#x503C;&#x5F97;&#x7EC6;&#x770B;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x7531;&#x4E8E;&#x65F6;&#x95F4;&#x6709;&#x9650;&#xFF0C;&#x5230;&#x8FD9;&#x91CC;&#x5DF2;&#x7ECF;&#x82B1;&#x4E86;&#x5F88;&#x591A;&#x65F6;&#x95F4;&#x641E;&#x8FD9;&#x4E8B;&#x513F;&#x4E86;&#x3002;&#x3002;&#x3002;</p>
<h1 id="&#x91CD;&#x8FDE;&#x673A;&#x5236;">&#x91CD;&#x8FDE;&#x673A;&#x5236;</h1>
<p>&#x8FD9;&#x91CC;&#x91CD;&#x70B9;&#x8BF4;&#x8BF4;&#x8FDE;&#x63A5;&#x94FE;&#x8DEF;&#x7684;&#x76F8;&#x5173;&#x4E8B;&#x60C5;&#x3002;&#x8BF4;&#x8BF4;&#x81EA;&#x52A8;&#x91CD;&#x8FDE;&#x5230;&#x5E95;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x3002;<br>&#x7167;&#x6837;&#x5148;&#x6765;&#x770B;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x4E2A;&#x81EA;&#x52A8;&#x91CD;&#x8FDE;&#x673A;&#x5236;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x65F6;&#x5E8F;&#x56FE;<br><a href="http://frodoking.github.io/img/android/okhttp_connection_reset.png" target="_blank"><img src="http://frodoking.github.io/img/android/okhttp_connection_reset.png" alt="OKHttp&#x91CD;&#x8FDE;&#x6267;&#x884C;&#x65F6;&#x5E8F;&#x56FE;"></a></p>
<p>&#x540C;&#x65F6;&#x56DE;&#x5230;Call.getResponse()&#x65B9;&#x6CD5;&#x8BF4;&#x8D77;</p>
<pre><code>Response getResponse(Request request, boolean forWebSocket) throws IOException {
    ...
    while (true) { // &#x81EA;&#x52A8;&#x91CD;&#x8FDE;&#x673A;&#x5236;&#x7684;&#x5FAA;&#x73AF;&#x5904;&#x7406;
      if (canceled) {
        engine.releaseConnection();
        return null;
      }

      try {
        engine.sendRequest();
        engine.readResponse();
      } catch (IOException e) {
        //&#x5982;&#x679C;&#x4E0A;&#x4E00;&#x6B21;&#x8FDE;&#x63A5;&#x5F02;&#x5E38;&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x524D;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x6062;&#x590D;&#x3002;
        HttpEngine retryEngine = engine.recover(e, null);
        if (retryEngine != null) {
          engine = retryEngine;
          continue;//&#x5982;&#x679C;&#x6062;&#x590D;&#x6210;&#x529F;&#xFF0C;&#x90A3;&#x4E48;&#x7EE7;&#x7EED;&#x91CD;&#x65B0;&#x8BF7;&#x6C42;
        }

        // Give up; recovery is not possible.&#x5982;&#x679C;&#x4E0D;&#x884C;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E2D;&#x65AD;&#x4E86;
        throw e;
      }

      Response response = engine.getResponse();
      Request followUp = engine.followUpRequest();
      ...
    }
  }
</code></pre><p>&#x76F8;&#x4FE1;&#x8FD9;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x80FD;&#x8BA9;&#x540C;&#x5B66;&#x4EEC;&#x6E05;&#x6670;&#x7684;&#x770B;&#x5230;&#x81EA;&#x52A8;&#x91CD;&#x8FDE;&#x673A;&#x5236;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8BE6;&#x7EC6;&#x7684;&#x6B65;&#x9AA4;&#xFF1A;</p>
<blockquote>
<p>1&#x3001;HttpEngine.recover()&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x662F;&#x901A;&#x8FC7;&#x68C0;&#x6D4B;RouteSelector&#x662F;&#x5426;&#x8FD8;&#x6709;&#x66F4;&#x591A;&#x7684;routes&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x8FDE;&#x63A5;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x53BB;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#x7B49;&#x7B49;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x5224;&#x65AD;&#x3002;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x4F1A;&#x4E3A;&#x91CD;&#x65B0;&#x8FDE;&#x63A5;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x4E00;&#x4EFD;&#x65B0;&#x7684;HttpEngine&#xFF0C;&#x540C;&#x65F6;&#x628A;&#x76F8;&#x5E94;&#x7684;&#x94FE;&#x8DEF;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x8FC7;&#x53BB;&#xFF1B;<br>2&#x3001;&#x5F53;&#x6062;&#x590D;&#x540E;&#x7684;HttpEngine&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x90A3;&#x4E48;&#x66FF;&#x6362;&#x5F53;&#x524D;Call&#x4E2D;&#x7684;&#x5F53;&#x524D;HttpEngine&#xFF0C;&#x6267;&#x884C;while&#x7684;continue&#xFF0C;&#x53D1;&#x8D77;&#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x8BF7;&#x6C42;&#xFF1B;<br>3&#x3001;&#x518D;&#x91CD;&#x70B9;&#x5F3A;&#x8C03;&#x4E00;&#x70B9;HttpEngine.sendRequest()&#x3002;&#x8FD9;&#x91CC;&#x4E4B;&#x524D;&#x5206;&#x6790;&#x8FC7;&#x4F1A;&#x89E6;&#x53D1;connect()&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x901A;&#x8FC7;RouteSelector.next()&#x518D;&#x53BB;&#x627E;&#x5F53;&#x524D;&#x9002;&#x5408;&#x7684;Route&#x3002;&#x591A;&#x8BF4;&#x4E00;&#x70B9;&#xFF0C;next()&#x65B9;&#x6CD5;&#x4F1A;&#x4F20;&#x9012;&#x5230;nextInetSocketAddress()&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x6B64;&#x5904;&#x4E00;&#x6BB5;&#x91CD;&#x8981;&#x7684;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x5C31;&#x662F;network.resolveInetAddresses(socketHost)&#x3002;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#x5728;Network&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x5BF9;&#x8BE5;&#x63A5;&#x53E3;&#x7684;DEFAULT&#x7684;&#x5B9E;&#x73B0;&#x57DF;&#xFF0C;&#x800C;&#x8BE5;&#x65B9;&#x6CD5;&#x901A;&#x8FC7;&#x5DE5;&#x5177;&#x7C7B;InetAddress.getAllByName(host)&#x6765;&#x5B8C;&#x6210;&#x5BF9;&#x6570;&#x7EC4;&#x7C7B;&#x7684;&#x5730;&#x5740;&#x89E3;&#x6790;&#x3002;<br>&#x6240;&#x4EE5;&#xFF0C;&#x591A;&#x5730;&#x5740;&#x53EF;&#x4EE5;&#x91C7;&#x7528;[&#x201C;[<a href="http://aaaaa&quot;,&quot;https://bbbbbb&quot;]&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x914D;&#x7F6E;&#x3002;]%28http://aaaaa&quot;%2C&quot;https//bbbbbb&quot;]&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x914D;&#x7F6E;&#x3002;" target="_blank">http://aaaaa&quot;,&quot;https://bbbbbb&quot;]&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x914D;&#x7F6E;&#x3002;](http://aaaaa&quot;%2C&quot;https//bbbbbb&quot;]&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x914D;&#x7F6E;&#x3002;</a>)</p>
</blockquote>
<h1 id="gzip&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;">Gzip&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;</h1>
<p>&#x5728;&#x6E90;&#x7801;&#x5F15;&#x5BFC;RequestBodyCompression.java&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;gzip&#x7684;&#x4F7F;&#x7528;&#x8EAB;&#x5F71;&#x3002;&#x901A;&#x8FC7;&#x62E6;&#x622A;&#x5668;&#x5BF9;Request &#x7684;body&#x8FDB;&#x884C;gzip&#x7684;&#x538B;&#x7F29;&#xFF0C;&#x6765;&#x51CF;&#x5C11;&#x6D41;&#x91CF;&#x7684;&#x4F20;&#x8F93;&#x3002;<br>Gzip&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x5F0F;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;GzipSink&#x5BF9;&#x666E;&#x901A;sink&#x7684;&#x5C01;&#x88C5;&#x538B;&#x7F29;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x5C31;&#x4E0D;&#x518D;&#x8D34;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x6709;&#x5174;&#x8DA3;&#x540C;&#x5B66;&#x5BF9;&#x7167;&#x6E90;&#x7801;&#x770B;&#x4E00;&#x4E0B;&#x5C31;ok&#x3002;</p>
<p>&#x5F3A;&#x5927;&#x7684;Interceptor&#x8BBE;&#x8BA1;&#x5E94;&#x8BE5;&#x4E5F;&#x7B97;&#x662F;&#x8FD9;&#x4E2A;&#x6846;&#x67B6;&#x7684;&#x4E00;&#x4E2A;&#x4EAE;&#x70B9;&#x3002;</p>
<h1 id="&#x5B89;&#x5168;&#x6027;">&#x5B89;&#x5168;&#x6027;</h1>
<p>&#x8FDE;&#x63A5;&#x5B89;&#x5168;&#x6027;&#x4E3B;&#x8981;&#x662F;&#x5728;HttpEngine.connect()&#x65B9;&#x6CD5;&#x3002;&#x4E0A;&#x4E00;&#x8282;&#x8BB2;&#x5230;&#x5730;&#x5740;&#x76F8;&#x5173;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x5728;HttpEngine&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x65B9;&#x6CD5;createAddress(client, networkRequest)&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x901A;&#x8FC7;&#x83B7;&#x53D6;&#x5230;OkHttpClient&#x4E2D;&#x5173;&#x4E8E;SSLSocketFactory&#x3001;HostnameVerifier&#x548C;CertificatePinner&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x3002;&#x800C;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x5927;&#x90E8;&#x5206;&#x91C7;&#x7528;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x3002;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x90FD;&#x4F1A;&#x5728;&#x540E;&#x9762;&#x7684;&#x91CD;&#x8FDE;&#x4E2D;&#x4F5C;&#x4E3A;&#x5BF9;&#x6BD4;&#x53C2;&#x8003;&#x9879;&#x3002;</p>
<p>&#x540C;&#x65F6;&#x5728;Connection.upgradeToTls()&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6709;&#x5BF9;SSLSocket&#x3001;SSLSocketFactory&#x7684;&#x521B;&#x5EFA;&#x6D3B;&#x52A8;&#x3002;&#x8FD9;&#x4E9B;&#x521B;&#x5EFA;&#x90FD;&#x4F1A;&#x88AB;&#x8BB0;&#x5F55;&#x5230;ConnectionSpec&#x4E2D;,&#x5F53;&#x53D1;&#x8D77;ConnectionSpec.apply()&#x4F1A;&#x53D1;&#x8D77;&#x4E00;&#x4E9B;&#x5217;&#x7684;&#x914D;&#x7F6E;&#x4EE5;&#x53CA;&#x9A8C;&#x8BC1;&#x3002;</p>
<p>&#x5EFA;&#x8BAE;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x540C;&#x5B66;&#x5148;&#x4E86;&#x89E3;java&#x7684;SSLSocket&#x76F8;&#x5173;&#x7684;&#x5F00;&#x53D1;&#x518D;&#x6765;&#x4E86;&#x89E3;&#x672C;&#x6846;&#x67B6;&#x4E2D;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x4F1A;&#x66F4;&#x80FD;&#x7406;&#x89E3;&#x4E00;&#x4E9B;&#x3002;</p>
<h1 id="&#x5E73;&#x53F0;&#x9002;&#x5E94;&#x6027;">&#x5E73;&#x53F0;&#x9002;&#x5E94;&#x6027;</h1>
<p>&#x8BB2;&#x4E86;&#x5F88;&#x591A;&#xFF0C;&#x7EC8;&#x4E8E;&#x6765;&#x5230;&#x4E86;&#x5E73;&#x53F0;&#x9002;&#x5E94;&#x6027;&#x4E86;&#x3002;Platform&#x662F;&#x6574;&#x4E2A;&#x5E73;&#x53F0;&#x9002;&#x5E94;&#x7684;&#x6838;&#x5FC3;&#x7C7B;&#x3002;&#x540C;&#x65F6;&#x5B83;&#x5C01;&#x88C5;&#x4E86;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x7684;&#x4E09;&#x4E2A;&#x5E73;&#x53F0;&#x7C7B;Android&#x548C;JdkWithJettyBootPlatform&#x3002;<br>&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5728;Platform.findPlatform&#x4E2D;</p>
<pre><code>private static Platform findPlatform() {
    // Attempt to find Android 2.3+ APIs.
    try {
      try {
        Class.forName(&quot;com.android.org.conscrypt.OpenSSLSocketImpl&quot;);
      } catch (ClassNotFoundException e) {
        // Older platform before being unbundled.
        Class.forName(&quot;org.apache.harmony.xnet.provider.jsse.OpenSSLSocketImpl&quot;);
      }

      OptionalMethod&lt;Socket&gt; setUseSessionTickets
          = new OptionalMethod&lt;&gt;(null, &quot;setUseSessionTickets&quot;, boolean.class);
      OptionalMethod&lt;Socket&gt; setHostname
          = new OptionalMethod&lt;&gt;(null, &quot;setHostname&quot;, String.class);
      Method trafficStatsTagSocket = null;
      Method trafficStatsUntagSocket = null;
      OptionalMethod&lt;Socket&gt; getAlpnSelectedProtocol = null;
      OptionalMethod&lt;Socket&gt; setAlpnProtocols = null;

      // Attempt to find Android 4.0+ APIs.
      try {
      //&#x6D41;&#x6D6A;&#x7EDF;&#x8BA1;&#x7C7B;
        Class&lt;?&gt; trafficStats = Class.forName(&quot;android.net.TrafficStats&quot;);
        trafficStatsTagSocket = trafficStats.getMethod(&quot;tagSocket&quot;, Socket.class);
        trafficStatsUntagSocket = trafficStats.getMethod(&quot;untagSocket&quot;, Socket.class);

        // Attempt to find Android 5.0+ APIs.
        try {
          Class.forName(&quot;android.net.Network&quot;); // Arbitrary class added in Android 5.0.
          getAlpnSelectedProtocol = new OptionalMethod&lt;&gt;(byte[].class, &quot;getAlpnSelectedProtocol&quot;);
          setAlpnProtocols = new OptionalMethod&lt;&gt;(null, &quot;setAlpnProtocols&quot;, byte[].class);
        } catch (ClassNotFoundException ignored) {
        }
      } catch (ClassNotFoundException | NoSuchMethodException ignored) {
      }

      return new Android(setUseSessionTickets, setHostname, trafficStatsTagSocket,
          trafficStatsUntagSocket, getAlpnSelectedProtocol, setAlpnProtocols);
    } catch (ClassNotFoundException ignored) {
      // This isn&apos;t an Android runtime.
    }

    // Find Jetty&apos;s ALPN extension for OpenJDK.
    try {
      String negoClassName = &quot;org.eclipse.jetty.alpn.ALPN&quot;;
      Class&lt;?&gt; negoClass = Class.forName(negoClassName);
      Class&lt;?&gt; providerClass = Class.forName(negoClassName + &quot;$Provider&quot;);
      Class&lt;?&gt; clientProviderClass = Class.forName(negoClassName + &quot;$ClientProvider&quot;);
      Class&lt;?&gt; serverProviderClass = Class.forName(negoClassName + &quot;$ServerProvider&quot;);
      Method putMethod = negoClass.getMethod(&quot;put&quot;, SSLSocket.class, providerClass);
      Method getMethod = negoClass.getMethod(&quot;get&quot;, SSLSocket.class);
      Method removeMethod = negoClass.getMethod(&quot;remove&quot;, SSLSocket.class);
      return new JdkWithJettyBootPlatform(
          putMethod, getMethod, removeMethod, clientProviderClass, serverProviderClass);
    } catch (ClassNotFoundException | NoSuchMethodException ignored) {
    }

    return new Platform();
  }
</code></pre><p>&#x8FD9;&#x91CC;&#x91C7;&#x7528;&#x4E86;JAVA&#x7684;&#x53CD;&#x5C04;&#x539F;&#x7406;&#x8C03;&#x7528;&#x5230;class&#x7684;method&#x3002;&#x6700;&#x540E;&#x5728;&#x5404;&#x81EA;&#x7684;&#x5E73;&#x53F0;&#x8C03;&#x7528;&#x4E0B;&#x53D1;&#x8D77;invoke&#x6765;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x65B9;&#x6CD5;&#x3002;&#x8BE6;&#x60C5;&#x8BF7;&#x53C2;&#x770B;&#x7EE7;&#x627F;&#x4E86;Platform&#x7684;Android&#x7C7B;&#x3002;<br>&#x5F53;&#x7136;&#x8981;&#x505A;&#x8FD9;&#x4E24;&#x79CD;&#x7684;&#x5E73;&#x53F0;&#x9002;&#x5E94;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x77E5;&#x9053;&#x5F53;&#x524D;&#x5E73;&#x53F0;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x76F8;&#x5173;&#x7684;class&#x5730;&#x5740;&#x4EE5;&#x53CA;&#x76F8;&#x5173;&#x65B9;&#x6CD5;&#x3002;</p>
<h1 id="&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</h1>
<p>1&#x3001;&#x4ECE;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#x548C;&#x7C7B;&#x5185;&#x90E8;&#x57DF;&#x4E2D;&#x90FD;&#x53EF;&#x4EE5;&#x770B;&#x5230;OkHttpClient&#xFF0C;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E0E;&#x5B89;&#x5353;&#x7684;ApplicationContext&#x3002;&#x770B;&#x8D77;&#x6765;&#x66F4;&#x50CF;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x7684;&#x7C7B;&#xFF0C;&#x8FD9;&#x6837;&#x4F7F;&#x7528;&#x597D;&#x5904;&#x662F;&#x7EDF;&#x4E00;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x662F;&#x9AD8;&#x624B;&#xFF0C;&#x5EFA;&#x8BAE;&#x522B;&#x8FD9;&#x4E48;&#x7528;&#xFF0C;&#x539F;&#x56E0;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x903B;&#x8F91;&#x7275;&#x8FDE;&#x592A;&#x6DF1;&#xFF0C;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x8981;&#x53BB;&#x8FFD;&#x8E2A;&#x4F60;&#x4F1A;&#x6709;&#x6DF1;&#x6DF1;&#x5730;&#x7F6A;&#x6076;&#x611F;&#x7684;&#xFF1B;<br>2&#x3001;&#x6846;&#x67B6;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x52A8;&#x6001;&#x65B9;&#x6CD5;&#x3001;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x3001;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x4EE5;&#x53CA;Internal&#x7684;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x76F8;&#x5F53;&#x89C4;&#x6574;&#xFF0C;&#x6BCF;&#x4E2A;&#x4E0D;&#x540C;&#x7C7B;&#x7684;&#x4E0D;&#x540C;&#x529F;&#x80FD;&#x80FD;&#x5212;&#x5206;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;&#x3002;&#x5F88;&#x503C;&#x5F97;&#x5F00;&#x53D1;&#x8005;&#x5B66;&#x4E60;&#x7684;&#x5730;&#x65B9;&#xFF1B;<br>3&#x3001;&#x4ECE;&#x5E73;&#x53F0;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x6765;&#x8BB2;&#xFF0C;&#x4E5F;&#x662F;&#x5F88;&#x4E0D;&#x9519;&#x7684;&#x5178;&#x8303;&#xFF08;&#x5982;&#x679C;&#x4F60;&#x4EE5;&#x540E;&#x8981;&#x4ECE;&#x4E8B;API&#x76F8;&#x5173;&#x7F16;&#x7801;&#xFF0C;&#x90A3;&#x66F4;&#x5F97;&#x597D;&#x597D;&#x6CE8;&#x610F;&#x5BF9;&#x517C;&#x5BB9;&#x6027;&#x7684;&#x5904;&#x7406;&#xFF09;&#xFF1B;<br>4&#x3001;&#x7531;&#x4E8E;&#x65F6;&#x95F4;&#x4E0D;&#x662F;&#x5F88;&#x5BCC;&#x88D5;&#xFF0C;&#x6240;&#x4EE5;&#x672C;&#x4EBA;&#x5BF9;&#x7EC6;&#x8282;&#x7684;&#x628A;&#x63E1;&#x8FD8;&#x662F;&#x4E0D;&#x591F;&#xFF0C;&#x8FD9;&#x65B9;&#x9762;&#x8FD8;&#x5F97;&#x591A;&#x591A;&#x52AA;&#x529B;&#xFF1B;<br>5&#x3001;&#x5BF9;&#x4E8E;&#x521D;&#x5B66;&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#x7684;&#x540C;&#x5B66;&#x6765;&#x8BF4;&#xFF0C;&#x53EF;&#x80FD;&#x4E00;&#x5F00;&#x59CB;&#x5B66;&#x4E60;&#x90FD;&#x662F;&#x4ECE;&#x7B80;&#x5355;&#x7684;socket&#x7684;&#x53D1;&#x8D77;&#x7136;&#x540E;&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x5F00;&#x59CB;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x5F88;&#x597D;&#x7684;&#x573A;&#x666F;&#x80FD;&#x8BA9;&#x81EA;&#x5DF1;&#x77E5;&#x9053;&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#x5230;&#x5E95;&#x6709;&#x591A;&#x4E48;&#x7684;&#x91CD;&#x8981;&#xFF0C;&#x5F53;&#x7136;&#x4F30;&#x8BA1;&#x4E5F;&#x6CA1;&#x611F;&#x53D7;&#x5230;&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#x6709;&#x591A;&#x4E48;&#x7684;&#x96BE;&#x53D7;&#x3002;&#x6211;&#x60F3;&#x8FD9;&#x662F;&#x5F88;&#x591A;&#x521A;&#x5165;&#x884C;&#x7684;&#x540C;&#x5B66;&#x4EEC;&#x7684;&#x4E00;&#x79CD;&#x5185;&#x5FC3;&#x75DB;&#x82E6;&#x4E4B;&#x5904;&#xFF1B;<br>6&#x3001;&#x4E0D;&#x8DB3;&#x7684;&#x5730;&#x65B9;&#x662F;&#x6CA1;&#x6709;&#x5BF9;SPDY&#x7684;&#x65B9;&#x5F0F;&#x6700;&#x8BE6;&#x7EC6;&#x8DDF;&#x8FDB;&#x5256;&#x6790;&#xFF08;&#x624B;&#x5934;&#x8FD8;&#x6709;&#x5DE5;&#x4F5C;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x540E;&#x9762;&#x5982;&#x679C;&#x6709;&#x65F6;&#x95F4;&#x518D;&#x8865;&#x8D77;&#x6765;&#x5427;&#xFF09;&#x3002;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../RxJava/背压问题.html" class="navigation navigation-prev " aria-label="Previous page: RxJava的背压问题">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Dispatcher.html" class="navigation navigation-next " aria-label="Next page: Dispatcher">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"OkHttp","level":"3.5","depth":1,"next":{"title":"Dispatcher","level":"3.5.1","depth":2,"path":"开源框架/OKHttp/Dispatcher.md","ref":"开源框架/OKHttp/Dispatcher.md","articles":[]},"previous":{"title":"RxJava的背压问题","level":"3.4.1","depth":2,"path":"开源框架/RxJava/背压问题.md","ref":"开源框架/RxJava/背压问题.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"开源框架/OKHttp/OkHttp的实现原理.md","mtime":"2018-10-14T15:59:37.595Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-10-14T16:00:24.685Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

